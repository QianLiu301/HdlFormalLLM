<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Hardware Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap"
          rel="stylesheet">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #f0f1f3;
            --border-color: #e0e0e0;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --accent: #00a884;
            --accent-hover: #008f70;
            --accent-blue: #2563eb;
            --accent-purple: #7c3aed;
            --accent-orange: #f59e0b;
            --error: #dc2626;
            --success: #00a884;
            --warning: #f59e0b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; padding: 32px 24px; }

        /* Header */
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .header h1 .accent { color: var(--accent); }
        .header h1 .blue { color: var(--accent-blue); }
        .header p { color: var(--text-secondary); font-size: 15px; }

        /* Pipeline Overview */
        .pipeline-overview { display: flex; justify-content: center; gap: 8px; margin-bottom: 40px; flex-wrap: wrap; }
        .pipeline-step-indicator { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--bg-secondary); border-radius: 20px; font-size: 13px; color: var(--text-secondary); border: 1px solid var(--border-color); }
        .pipeline-step-indicator.active { background: var(--accent-blue); color: white; border-color: var(--accent-blue); }
        .pipeline-step-indicator.completed { background: var(--accent); color: white; border-color: var(--accent); }
        .pipeline-step-indicator .num { width: 20px; height: 20px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 11px; }
        .pipeline-step-indicator.active .num, .pipeline-step-indicator.completed .num { background: rgba(255,255,255,0.3); }
        .pipeline-arrow { color: var(--border-color); font-size: 18px; display: flex; align-items: center; }

        /* Step Section */
        .step-section { margin-bottom: 32px; border: 1px solid var(--border-color); border-radius: 16px; overflow: hidden; background: var(--bg-primary); }
        .step-header { display: flex; align-items: center; gap: 16px; padding: 20px 24px; background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); cursor: pointer; user-select: none; }
        .step-header:hover { background: var(--bg-tertiary); }
        .step-number { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; flex-shrink: 0; }
        .step-number.blue { background: rgba(37, 99, 235, 0.15); color: var(--accent-blue); }
        .step-number.green { background: rgba(0, 168, 132, 0.15); color: var(--accent); }
        .step-number.orange { background: rgba(245, 158, 11, 0.15); color: var(--accent-orange); }
        .step-number.purple { background: rgba(124, 58, 237, 0.15); color: var(--accent-purple); }
        .step-number.completed { background: var(--accent); color: white; }
        .step-title-area { flex: 1; }
        .step-title { font-size: 16px; font-weight: 600; margin-bottom: 2px; }
        .step-subtitle { font-size: 13px; color: var(--text-secondary); }
        .step-status { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .step-status.pending { background: var(--bg-tertiary); color: var(--text-secondary); }
        .step-status.in-progress { background: rgba(37, 99, 235, 0.15); color: var(--accent-blue); }
        .step-status.completed { background: rgba(0, 168, 132, 0.15); color: var(--accent); }
        .step-toggle { font-size: 20px; color: var(--text-secondary); transition: transform 0.3s; }
        .step-section.collapsed .step-toggle { transform: rotate(-90deg); }
        .step-section.collapsed .step-content { display: none; }
        .step-content { padding: 24px; }

        /* Mode Switcher */
        .mode-switcher { display: flex; gap: 8px; margin-bottom: 20px; background: var(--bg-tertiary); padding: 4px; border-radius: 10px; }
        .mode-btn { flex: 1; padding: 12px 16px; background: transparent; border: none; border-radius: 8px; font-family: inherit; font-size: 14px; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .mode-btn:hover { color: var(--text-primary); }
        .mode-btn.active { background: var(--bg-primary); color: var(--accent-blue); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .mode-content { display: none; }
        .mode-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Upload Area */
        .upload-area { border: 2px dashed var(--border-color); border-radius: 12px; padding: 40px 24px; text-align: center; transition: all 0.2s; cursor: pointer; background: var(--bg-secondary); }
        .upload-area:hover, .upload-area.dragover { border-color: var(--accent-blue); background: rgba(37, 99, 235, 0.05); }
        .upload-area.dragover { transform: scale(1.01); }
        .upload-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.6; }
        .upload-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .upload-subtitle { font-size: 13px; color: var(--text-secondary); margin-bottom: 16px; }
        .upload-info { display: flex; justify-content: center; gap: 16px; flex-wrap: wrap; }
        .upload-info-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary); background: var(--bg-primary); padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border-color); }
        .upload-input { display: none; }

        /* Upload Result */
        .upload-result { display: none; margin-top: 20px; }
        .upload-result.visible { display: block; }
        .file-info-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 10px; padding: 16px; margin-bottom: 16px; }
        .file-info-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .file-info-icon { width: 40px; height: 40px; background: rgba(37, 99, 235, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .file-info-details h4 { font-size: 14px; font-weight: 600; margin-bottom: 2px; }
        .file-info-details p { font-size: 12px; color: var(--text-secondary); }
        .file-info-actions { margin-left: auto; }

        /* Module Selector */
        .module-selector { background: rgba(245, 158, 11, 0.08); border: 1px solid rgba(245, 158, 11, 0.2); border-radius: 10px; padding: 16px; margin-bottom: 16px; }
        .module-selector-title { font-size: 13px; font-weight: 600; color: var(--accent-orange); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .module-selector select { width: 100%; padding: 10px 14px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; }

        /* Detected Info */
        .detected-info { background: var(--bg-tertiary); border-radius: 8px; padding: 12px 16px; margin-bottom: 16px; }
        .detected-info-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px; }
        .detected-info-row:not(:last-child) { border-bottom: 1px solid var(--border-color); }
        .detected-info-label { color: var(--text-secondary); }
        .detected-info-value { font-weight: 500; font-family: 'JetBrains Mono', monospace; }
        .confidence-badge { padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; }
        .confidence-badge.high { background: rgba(0, 168, 132, 0.15); color: var(--accent); }
        .confidence-badge.medium { background: rgba(245, 158, 11, 0.15); color: var(--accent-orange); }
        .confidence-badge.low { background: rgba(220, 38, 38, 0.15); color: var(--error); }

        /* Card & Form */
        .card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; margin-bottom: 16px; }
        .card-title { font-size: 14px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; color: var(--text-secondary); }
        .form-group { margin-bottom: 16px; }
        .form-row { display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap; }
        .form-row .form-group { flex: 1; min-width: 140px; margin-bottom: 0; }
        label { display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
        select, textarea, input[type="text"] { width: 100%; padding: 10px 14px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-family: inherit; font-size: 14px; transition: border-color 0.2s, box-shadow 0.2s; }
        select:focus, textarea:focus, input[type="text"]:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23666' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 36px; }
        textarea { min-height: 100px; resize: vertical; font-family: 'JetBrains Mono', monospace; font-size: 13px; }
        .divider { display: flex; align-items: center; margin: 16px 0; color: var(--text-secondary); font-size: 12px; }
        .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--border-color); }
        .divider span { padding: 0 12px; }

        /* Buttons */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 24px; font-family: inherit; font-size: 14px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--accent-blue); color: #ffffff; width: 100%; }
        .btn-primary.green { background: var(--accent); }
        .btn-primary:hover:not(:disabled) { transform: translateY(-1px); filter: brightness(1.1); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background: var(--border-color); }
        .btn-sm { padding: 8px 16px; font-size: 13px; }
        .btn-danger { background: rgba(220, 38, 38, 0.1); color: var(--error); border: 1px solid rgba(220, 38, 38, 0.3); }
        .btn-danger:hover { background: rgba(220, 38, 38, 0.2); }

        .spinner { width: 16px; height: 16px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Stream Status */
        .stream-status { display: none; align-items: center; gap: 10px; padding: 12px 14px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 12px; font-size: 13px; }
        .stream-status.visible { display: flex; }
        .stream-status .dot { width: 8px; height: 8px; background: var(--accent-blue); border-radius: 50%; animation: pulse 1s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        /* Result */
        .result { display: none; }
        .result.visible { display: block; animation: fadeIn 0.3s ease; }
        .result-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color); }
        .result-header .icon { width: 36px; height: 36px; background: rgba(0, 168, 132, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .result-header .info h3 { font-size: 14px; font-weight: 600; margin-bottom: 2px; }
        .result-header .info p { font-size: 12px; color: var(--text-secondary); }
        .result-header .badge { margin-left: auto; padding: 4px 10px; background: var(--bg-tertiary); border-radius: 4px; font-size: 11px; font-weight: 600; color: var(--accent-blue); text-transform: uppercase; }
        .preview-label { font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
        .preview-box { background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 14px; font-family: 'JetBrains Mono', monospace; font-size: 12px; line-height: 1.6; min-height: 150px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; word-break: break-word; color: #333; }
        .preview-box .cursor { display: inline-block; width: 2px; height: 1.1em; background: var(--accent-blue); animation: blink 0.8s step-end infinite; vertical-align: text-bottom; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .action-buttons { display: flex; gap: 10px; margin-top: 16px; flex-wrap: wrap; }
        .action-buttons .btn { flex: 1; min-width: 120px; }

        /* Error */
        .error-message { background: rgba(220, 38, 38, 0.1); border: 1px solid rgba(220, 38, 38, 0.3); border-radius: 8px; padding: 12px 14px; color: var(--error); font-size: 13px; display: none; margin-bottom: 12px; }
        .error-message.visible { display: block; }

        /* Success Message */
        .success-message { background: rgba(0, 168, 132, 0.1); border: 1px solid rgba(0, 168, 132, 0.3); border-radius: 8px; padding: 12px 14px; color: var(--accent); font-size: 13px; display: none; margin-bottom: 12px; }
        .success-message.visible { display: block; }

        /* Examples */
        .examples { margin-top: 8px; }
        .examples-title { font-size: 11px; color: var(--text-secondary); margin-bottom: 6px; }
        .example-chips { display: flex; flex-wrap: wrap; gap: 6px; }
        .example-chip { padding: 5px 10px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 6px; font-size: 11px; font-family: 'JetBrains Mono', monospace; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; }
        .example-chip:hover { border-color: var(--accent-blue); color: var(--accent-blue); }

        /* Toggle */
        .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-top: 1px solid var(--border-color); margin-top: 12px; }
        .toggle-label { font-size: 13px; color: var(--text-secondary); }
        .toggle-switch { position: relative; width: 40px; height: 22px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; inset: 0; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 22px; transition: 0.3s; }
        .toggle-slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background: var(--text-secondary); border-radius: 50%; transition: 0.3s; }
        .toggle-switch input:checked + .toggle-slider { background: var(--accent); border-color: var(--accent); }
        .toggle-switch input:checked + .toggle-slider:before { transform: translateX(18px); background: #ffffff; }

        /* DUT Status */
        .dut-status { display: none; background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(37, 99, 235, 0.03)); border: 1px solid rgba(37, 99, 235, 0.2); border-radius: 10px; padding: 14px 16px; margin-bottom: 16px; }
        .dut-status.visible { display: block; }
        .dut-status-header { display: flex; align-items: center; gap: 10px; }
        .dut-status-icon { font-size: 18px; }
        .dut-status-info { flex: 1; }
        .dut-status-info h4 { font-size: 13px; font-weight: 600; color: var(--accent-blue); margin-bottom: 2px; }
        .dut-status-info p { font-size: 12px; color: var(--text-secondary); }
        .dut-status-info .filename { font-family: 'JetBrains Mono', monospace; color: var(--text-primary); font-weight: 500; }
        .dut-status-badge { padding: 3px 8px; background: rgba(37, 99, 235, 0.15); border-radius: 4px; font-size: 10px; font-weight: 600; color: var(--accent-blue); text-transform: uppercase; }
        .dut-status .source-badge { background: rgba(124, 58, 237, 0.15); color: var(--accent-purple); margin-left: 6px; }

        /* No DUT Warning */
        .no-dut-warning { display: none; background: rgba(245, 158, 11, 0.08); border: 1px solid rgba(245, 158, 11, 0.2); border-radius: 10px; padding: 14px 16px; margin-bottom: 16px; }
        .no-dut-warning.visible { display: flex; align-items: center; gap: 12px; }
        .no-dut-warning-icon { font-size: 18px; }
        .no-dut-warning-text { flex: 1; }
        .no-dut-warning-text h4 { font-size: 13px; font-weight: 600; color: var(--accent-orange); margin-bottom: 2px; }
        .no-dut-warning-text p { font-size: 12px; color: var(--text-secondary); }

        /* Synced indicator */
        .synced-indicator { display: inline-flex; align-items: center; gap: 5px; font-size: 11px; color: var(--accent); margin-top: 6px; }
        .synced-indicator::before { content: ''; width: 6px; height: 6px; background: var(--accent); border-radius: 50%; }

        /* Coming Soon */
        .coming-soon { padding: 40px 24px; text-align: center; color: var(--text-secondary); }
        .coming-soon-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.5; }
        .coming-soon h3 { font-size: 16px; font-weight: 600; margin-bottom: 4px; color: var(--text-primary); }
        .coming-soon p { font-size: 13px; }

        /* Footer */
        .footer { text-align: center; padding: 32px 0 16px; color: var(--text-secondary); font-size: 12px; }
        .footer p { margin-bottom: 4px; }
        .footer a { color: var(--accent); text-decoration: none; }
        .footer a:hover { text-decoration: underline; }

        @media (max-width: 640px) {
            .form-row { flex-direction: column; }
            .form-row .form-group { min-width: 100%; }
            .pipeline-overview { gap: 4px; }
            .pipeline-step-indicator { padding: 6px 10px; font-size: 11px; }
            .mode-switcher { flex-direction: column; }
        }
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.visible {
            display: flex;
        }
        .modal-content {
            background: var(--bg-primary);
            border-radius: 16px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }
        .modal-header h2 {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: 6px;
        }
        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        .modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(85vh - 140px);
        }
        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 24px;
            font-size: 14px;
        }
        .comparison-table th {
            background: var(--bg-secondary);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }
        .comparison-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .comparison-table tr:hover {
            background: var(--bg-secondary);
        }
        .rank-medal {
            font-size: 18px;
        }

        /* Bar Chart */
        .chart-container {
            margin-top: 20px;
        }
        .chart-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }
        .chart-bar-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .chart-bar-label {
            width: 100px;
            font-size: 13px;
            font-weight: 500;
        }
        .chart-bar-container {
            flex: 1;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 12px;
        }
        .chart-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .chart-bar.rank-1 { background: linear-gradient(90deg, #ffd700, #ffec80); }
        .chart-bar.rank-2 { background: linear-gradient(90deg, #c0c0c0, #e0e0e0); }
        .chart-bar.rank-3 { background: linear-gradient(90deg, #cd7f32, #daa06d); }
        .chart-bar.rank-other { background: linear-gradient(90deg, var(--accent-blue), #60a5fa); }
        .chart-bar-value {
            font-size: 13px;
            font-weight: 600;
            min-width: 60px;
        }
        /* Welcome Page */
        .welcome-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px 24px;
        }
        .welcome-logo {
            font-size: 64px;
            margin-bottom: 24px;
        }
        .welcome-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .welcome-title .accent { color: var(--accent); }
        .welcome-title .blue { color: var(--accent-blue); }
        .welcome-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            max-width: 600px;
            margin-bottom: 32px;
            line-height: 1.7;
        }
        .welcome-paper {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 40px;
            text-decoration: none;
            transition: all 0.2s;
        }
        .welcome-paper:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }
        .welcome-btn {
            padding: 16px 48px;
            font-size: 18px;
            font-weight: 600;
            background: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .welcome-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
        }
        .welcome-features {
            display: flex;
            gap: 32px;
            margin-top: 60px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .welcome-feature {
            text-align: center;
            max-width: 200px;
        }
        .welcome-feature-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }
        .welcome-feature-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .welcome-feature-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Main App (hidden by default) */
        .main-app {
            display: none;
        }
        .main-app.visible {
            display: block;
        }

        /* Footer Links */
        .footer-links {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 8px;
        }
        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 12px;
            transition: color 0.2s;
        }
        .footer-link:hover {
            color: var(--accent);
        }
        .footer-separator {
            color: var(--border-color);
        }

        /* Legal Notice Modal */
        .legal-content {
            font-size: 14px;
            line-height: 1.8;
        }
        .legal-content h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 20px 0 12px 0;
            color: var(--text-primary);
        }
        .legal-content h3:first-child {
            margin-top: 0;
        }
        .legal-content p {
            margin-bottom: 8px;
            color: var(--text-secondary);
        }
        .legal-content a {
            color: var(--accent-blue);
            text-decoration: none;
        }
        .legal-content a:hover {
            text-decoration: underline;
        }

        /* Developer Modal */
        .dev-input-group {
            margin-bottom: 20px;
        }
        .dev-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .dev-input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
        }
        .dev-input-group input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        .dev-error {
            color: var(--error);
            font-size: 13px;
            margin-top: 8px;
            display: none;
        }
        .dev-error.visible {
            display: block;
        }
        .dev-links {
            display: none;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            text-align: center;
        }
        .dev-links.visible {
            display: block;
        }
        .dev-links a {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--text-primary);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .dev-links a:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
 <!-- ========== Welcome Page ========== -->
    <div class="welcome-page" id="welcome-page">
        <div class="welcome-logo">üî¨</div>
        <h1 class="welcome-title">
            <span class="blue">LLM</span>-based Hardware <span class="accent">Verification</span>
        </h1>
        <p class="welcome-subtitle">
            An automated pipeline for generating hardware designs and verification tests using Large Language Models.
            Transform natural language specifications into Verilog code and BDD test scenarios.
        </p>
        <a href="https://arxiv.org/abs/2512.17814" target="_blank" class="welcome-paper">
            üìÑ Read the Paper: arXiv:2512.17814
        </a>
        <button class="welcome-btn" onclick="enterApp()">
            üöÄ Start Using Tool
        </button>
        <div class="welcome-features">
            <div class="welcome-feature">
                <div class="welcome-feature-icon">ü§ñ</div>
                <div class="welcome-feature-title">Multi-LLM Support</div>
                <div class="welcome-feature-desc">GPT, Claude, Gemini, Groq, DeepSeek</div>
            </div>
            <div class="welcome-feature">
                <div class="welcome-feature-icon">‚ö°</div>
                <div class="welcome-feature-title">Automated Pipeline</div>
                <div class="welcome-feature-desc">DUT ‚Üí BDD ‚Üí Testbench</div>
            </div>
            <div class="welcome-feature">
                <div class="welcome-feature-icon">üìä</div>
                <div class="welcome-feature-title">Quality Analysis</div>
                <div class="welcome-feature-desc">Coverage & comparison reports</div>
            </div>
        </div>

        <!-- Ê∑ªÂä†‰ΩúËÄÖÂíå Legal Notice -->
        <div style="margin-top: 48px; text-align: center;">
            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                Authors: Rolf Drechsler, Qian Liu
            </p>
            <p style="font-size: 12px;">
                <a href="#" onclick="showLegalModal(); return false;"
                   style="color: var(--accent); text-decoration: none;">
                    Imprint / Legal Notice
                </a>
            </p>
        </div>
    </div>
        </div>
    </div>

    <!-- ========== Main Application ========== -->
<div class="main-app" id="main-app">
<div class="container">
    <!-- Header -->
    <div class="header">
        <h1>ü§ñ <span class="blue">LLM</span> Hardware <span class="accent">Verification</span></h1>
        <p>Generate hardware designs and verification tests using AI</p>
    </div>

    <!-- Pipeline Overview -->
    <div class="pipeline-overview">
        <div class="pipeline-step-indicator active" id="indicator-1">
            <span class="num">1</span> Hardware
        </div>
        <div class="pipeline-arrow">‚Üí</div>
        <div class="pipeline-step-indicator" id="indicator-2">
            <span class="num">2</span> BDD Tests
        </div>
        <div class="pipeline-arrow">‚Üí</div>
        <div class="pipeline-step-indicator" id="indicator-3">
            <span class="num">3</span> Testbench
        </div>
        <div class="pipeline-arrow">‚Üí</div>
        <div class="pipeline-step-indicator" id="indicator-4">
            <span class="num">4</span> Simulation
        </div>
    </div>

    <!-- Step 1: Hardware Generator -->
    <div class="step-section" id="step-1">
        <div class="step-header" onclick="toggleStep(1)">
            <div class="step-number blue" id="step-1-num">1</div>
            <div class="step-title-area">
                <div class="step-title">üîß Hardware Design (DUT)</div>
                <div class="step-subtitle">Generate with LLM or upload existing Verilog file</div>
            </div>
            <div class="step-status pending" id="step-1-status">Pending</div>
            <div class="step-toggle">‚ñº</div>
        </div>
        <div class="step-content">
            <!-- Mode Switcher -->
            <div class="mode-switcher">
                <button class="mode-btn active" onclick="switchMode('generate')" id="mode-generate-btn">
                    ü§ñ Generate with LLM
                </button>
                <button class="mode-btn" onclick="switchMode('upload')" id="mode-upload-btn">
                    üì§ Upload Existing File
                </button>
            </div>

            <!-- Generate Mode -->
            <div class="mode-content active" id="mode-generate">
                <div class="card">
                    <div class="card-title">‚ö° Configuration</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Module Type</label>
                            <select id="hw-module" onchange="onModuleChange()">
                                <option value="alu">ALU - Arithmetic Logic Unit</option>
                                <option value="counter">Counter - Up/Down Counter</option>
                                <option value="regfile">Register File</option>
                                <option value="cpu">CPU - RISC-V Processor</option>
                            </select>
                        </div>
                        <div class="form-group" id="hw-bitwidth-group">
                            <label>Bitwidth</label>
                            <select id="hw-bitwidth">
                                <option value="8">8-bit</option>
                                <option value="16">16-bit</option>
                                <option value="32" selected>32-bit</option>
                                <option value="64">64-bit</option>
                            </select>
                        </div>
                        <div class="form-group" id="hw-depth-group" style="display: none;">
                            <label>Registers</label>
                            <select id="hw-depth">
                                <option value="8">8 registers</option>
                                <option value="16">16 registers</option>
                                <option value="32" selected>32 registers</option>
                            </select>
                        </div>
                        <div class="form-group" id="hw-pipeline-group" style="display: none;">
                            <label>Pipeline</label>
                            <select id="hw-pipeline">
                                <option value="5" selected>5-stage</option>
                                <option value="3">3-stage</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>LLM Provider</label>
                            <select id="hw-llm" onchange="onHwLlmChange()">
                                <option value="groq">Groq</option>
                                <option value="deepseek">DeepSeek</option>
                                <option value="openai">OpenAI</option>
                                <option value="claude">Claude</option>
                                <option value="gemini">Gemini</option>
                            </select>
                        </div>
                        <div class="form-group" id="hw-model-group" style="display: none;">
                            <label>Model</label>
                            <select id="hw-model">
                                <option value="gpt-5-mini">GPT-5 Mini (Recommended)</option>
                                <option value="gpt-5">GPT-5</option>
                                <option value="gpt-5.1">GPT-5.1</option>
                            </select>
                        </div>
                    </div>
                    <div class="divider"><span>or use natural language</span></div>
                    <div class="form-group">
                        <label>Natural Language Input</label>
                        <input type="text" id="hw-input" placeholder="e.g., 32-bit counter or 16-bit ALU">
                        <div class="examples">
                            <div class="examples-title">Examples:</div>
                            <div class="example-chips">
                                <span class="example-chip" onclick="setHwExample('16-bit ALU')">16-bit ALU</span>
                                <span class="example-chip"
                                      onclick="setHwExample('32-bit counter')">32-bit Counter</span>
                                <span class="example-chip"
                                      onclick="setHwExample('32x32 register file')">32x32 RegFile</span>
                                <span class="example-chip"
                                      onclick="setHwExample('5-stage RISC-V CPU')">RISC-V CPU</span>
                            </div>
                        </div>
                    </div>
                    <div class="toggle-row">
                        <span class="toggle-label">‚ö° Stream output</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="hw-stream" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="error-message" id="hw-error"></div>
                <div class="stream-status" id="hw-status">
                    <div class="dot"></div>
                    <span id="hw-status-text">Generating...</span>
                </div>

                <button class="btn btn-primary" id="hw-btn" onclick="generateHardware()">
                    <span id="hw-btn-text">üîß Generate Hardware</span>
                    <div class="spinner" id="hw-spinner" style="display: none;"></div>
                </button>

                <div class="card result" id="hw-result" style="margin-top: 16px;">
                    <div class="result-header">
                        <div class="icon">‚úÖ</div>
                        <div class="info">
                            <h3 id="hw-filename">Generating...</h3>
                            <p id="hw-info">Ready to generate</p>
                        </div>
                        <div class="badge" id="hw-badge">LLM</div>
                    </div>
                    <div class="preview-label">Verilog Code Preview</div>
                    <div class="preview-box" id="hw-preview"></div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary btn-sm" id="hw-download" onclick="downloadHardware()">üì•
                            Download .v
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="resetHardware()">üîÑ Reset</button>
                    </div>
                </div>
            </div>

            <!-- Upload Mode -->
            <div class="mode-content" id="mode-upload">
                <div class="upload-area" id="upload-area" onclick="document.getElementById('upload-input').click()">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-title">Drag & drop your Verilog file here</div>
                    <div class="upload-subtitle">or click to browse</div>
                    <div class="upload-info">
                        <div class="upload-info-item">üìÑ .v, .sv files</div>
                        <div class="upload-info-item">üìè Max 1MB</div>
                        <div class="upload-info-item">üîí Secure upload</div>
                    </div>
                    <input type="file" id="upload-input" class="upload-input" accept=".v,.sv,.vh"
                           onchange="handleFileSelect(event)">
                </div>

                <div class="error-message" id="upload-error"></div>
                <div class="success-message" id="upload-success"></div>

                <!-- Upload Result -->
                <div class="upload-result" id="upload-result">
                    <div class="file-info-card">
                        <div class="file-info-header">
                            <div class="file-info-icon">üìÑ</div>
                            <div class="file-info-details">
                                <h4 id="uploaded-filename">alu_16bit.v</h4>
                                <p id="uploaded-filesize">2.3 KB ‚Ä¢ Uploaded successfully</p>
                            </div>
                            <div class="file-info-actions">
                                <button class="btn btn-danger btn-sm" onclick="removeUploadedFile()">‚úï Remove</button>
                            </div>
                        </div>
                    </div>

                    <!-- Module Selector (for multi-module files) -->
                    <div class="module-selector" id="module-selector" style="display: none;">
                        <div class="module-selector-title">‚ö†Ô∏è Multiple modules found - Please select one:</div>
                        <select id="module-select" onchange="onModuleSelect()">
                        </select>
                    </div>

                    <!-- Detected Info -->
                    <div class="detected-info" id="detected-info">
                        <div class="detected-info-row">
                            <span class="detected-info-label">Module Name</span>
                            <span class="detected-info-value" id="detected-module-name">alu_16bit</span>
                        </div>
                        <div class="detected-info-row">
                            <span class="detected-info-label">Detected Type</span>
                            <span>
                                    <span class="detected-info-value" id="detected-type">ALU</span>
                                    <span class="confidence-badge high" id="confidence-badge">High</span>
                                </span>
                        </div>
                        <div class="detected-info-row">
                            <span class="detected-info-label">Bitwidth</span>
                            <span class="detected-info-value" id="detected-bitwidth">16-bit</span>
                        </div>
                        <div class="detected-info-row">
                            <span class="detected-info-label">Inputs</span>
                            <span class="detected-info-value" id="detected-inputs">clk, rst_n, A, B, opcode</span>
                        </div>
                        <div class="detected-info-row">
                            <span class="detected-info-label">Outputs</span>
                            <span class="detected-info-value" id="detected-outputs">result, zero, overflow</span>
                        </div>
                    </div>

                    <!-- Override Type -->
                    <div class="card">
                        <div class="card-title">üîß Adjust Detection (Optional)</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Module Type</label>
                                <select id="override-type">
                                    <option value="alu">ALU - Arithmetic Logic Unit</option>
                                    <option value="counter">Counter - Up/Down Counter</option>
                                    <option value="regfile">Register File</option>
                                    <option value="cpu">CPU - Processor</option>
                                    <option value="other">Other - Custom Module</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Bitwidth Override</label>
                                <select id="override-bitwidth">
                                    <option value="auto">Auto-detected</option>
                                    <option value="8">8-bit</option>
                                    <option value="16">16-bit</option>
                                    <option value="32">32-bit</option>
                                    <option value="64">64-bit</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="confirmUpload()">
                        ‚úÖ Use This File as DUT
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 2: BDD Generator -->
    <div class="step-section" id="step-2">
        <div class="step-header" onclick="toggleStep(2)">
            <div class="step-number green" id="step-2-num">2</div>
            <div class="step-title-area">
                <div class="step-title">üß™ Generate BDD Test Scenarios</div>
                <div class="step-subtitle">Create Gherkin test cases for the DUT</div>
            </div>
            <div class="step-status pending" id="step-2-status">Pending</div>
            <div class="step-toggle">‚ñº</div>
        </div>
        <div class="step-content">
            <!-- DUT Status -->
            <div class="dut-status" id="dut-status">
                <div class="dut-status-header">
                    <div class="dut-status-icon">üìã</div>
                    <div class="dut-status-info">
                        <h4>Current DUT</h4>
                        <p><span class="filename" id="dut-filename">-</span> ‚Ä¢ <span id="dut-type-display">-</span> ‚Ä¢
                            <span id="dut-bitwidth-display">-</span></p>
                    </div>
                    <div class="dut-status-badge" id="dut-module-badge">-</div>
                    <div class="dut-status-badge source-badge" id="dut-source-badge">LLM</div>
                </div>
            </div>

            <!-- No DUT Warning -->
            <div class="no-dut-warning visible" id="no-dut-warning">
                <div class="no-dut-warning-icon">‚ö†Ô∏è</div>
                <div class="no-dut-warning-text">
                    <h4>No Hardware Generated</h4>
                    <p>Complete Step 1 first to generate or upload hardware.</p>
                </div>
            </div>

            <div class="card">
                <div class="card-title">‚ö° Configuration</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>LLM Provider</label>
                        <select id="bdd-llm" onchange="onBddLlmChange()">
                            <option value="groq">Groq</option>
                            <option value="deepseek">DeepSeek</option>
                            <option value="openai">OpenAI</option>
                            <option value="claude">Claude</option>
                            <option value="gemini">Gemini</option>
                        </select>
                    </div>
                    <div class="form-group" id="bdd-model-group" style="display: none;">
                        <label>Model</label>
                        <select id="bdd-model">
                            <option value="gpt-5-mini">GPT-5 Mini (Recommended)</option>
                            <option value="gpt-5">GPT-5</option>
                            <option value="gpt-5.1">GPT-5.1</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Requirements (auto-filled based on DUT)</label>
                    <textarea id="bdd-input"
                              placeholder="Requirements will be auto-filled when you generate or upload hardware..."></textarea>
                    <div class="synced-indicator" id="synced-indicator" style="display: none;">Synced with DUT</div>
                    <div class="examples">
                        <div class="examples-title">Examples:</div>
                        <div class="example-chips" id="bdd-examples">
                            <span class="example-chip" onclick="setBddExample('Basic functionality verification')">Basic test</span>
                            <span class="example-chip" onclick="setBddExample('Test boundary values and edge cases')">Boundary</span>
                            <span class="example-chip"
                                  onclick="setBddExample('Reset behavior and initialization tests')">Reset</span>
                        </div>
                    </div>
                </div>
                <div class="toggle-row">
                    <span class="toggle-label">‚ö° Stream output</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="bdd-stream" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="error-message" id="bdd-error"></div>
            <div class="stream-status" id="bdd-status">
                <div class="dot"></div>
                <span id="bdd-status-text">Generating...</span>
            </div>

            <button class="btn btn-primary green" id="bdd-btn" onclick="generateBDD()">
                <span id="bdd-btn-text">üß™ Generate BDD Tests</span>
                <div class="spinner" id="bdd-spinner" style="display: none;"></div>
            </button>

            <div class="card result" id="bdd-result" style="margin-top: 16px;">
                <div class="result-header">
                    <div class="icon">‚úÖ</div>
                    <div class="info">
                        <h3 id="bdd-filename">Generating...</h3>
                        <p id="bdd-info">Ready to generate</p>
                    </div>
                    <div class="badge" id="bdd-badge">LLM</div>
                </div>
                <div class="preview-label">BDD Feature Preview</div>
                <div class="preview-box" id="bdd-preview"></div>
                <div class="action-buttons">
                    <button class="btn btn-secondary btn-sm" id="bdd-download" onclick="downloadBDD()">üì• Download
                        .feature
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="resetBDD()">üîÑ Reset</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 3: Testbench Generator -->
<div class="step-section collapsed" id="step-3">
    <div class="step-header" onclick="toggleStep(3)">
        <div class="step-number orange" id="step-3-num">3</div>
        <div class="step-title-area">
            <div class="step-title">‚öôÔ∏è Generate Verilog Testbench</div>
            <div class="step-subtitle">Convert BDD to Verilog testbench</div>
        </div>
        <div class="step-status pending" id="step-3-status">Pending</div>
        <div class="step-toggle">‚ñº</div>
    </div>
    <div class="step-content">
        <!-- BDD Source Status -->
        <div class="dut-status" id="bdd-source-status">
            <div class="dut-status-header">
                <div class="dut-status-icon">üìÑ</div>
                <div class="dut-status-info">
                    <h4>Source BDD</h4>
                    <p><span class="filename" id="tb-bdd-filename">-</span> ‚Ä¢ <span id="tb-bdd-llm">-</span></p>
                </div>
                <div class="dut-status-badge" id="tb-module-badge">-</div>
            </div>
        </div>

        <!-- No BDD Warning -->
        <div class="no-dut-warning visible" id="no-bdd-warning">
            <div class="no-dut-warning-icon">‚ö†Ô∏è</div>
            <div class="no-dut-warning-text">
                <h4>No BDD File Generated</h4>
                <p>Complete Step 2 first to generate BDD test scenarios.</p>
            </div>
        </div>

        <div class="card">
            <div class="card-title">‚ö° Configuration</div>

            <!-- Mode Switcher -->
            <div class="form-group">
                <label>Generation Mode</label>
                <div class="mode-switcher" style="margin-top: 8px;">
                    <button class="mode-btn active" onclick="switchTbMode('single')" id="tb-mode-single-btn">
                        üìÑ Single File
                    </button>
                    <button class="mode-btn" onclick="switchTbMode('batch')" id="tb-mode-batch-btn">
                        üìö Batch (All BDD Files)
                    </button>
                </div>
            </div>

            <!-- Single Mode Options -->
            <div id="tb-single-options">
                <div class="form-row">
                    <div class="form-group">
                        <label>DUT Module Name</label>
                        <input type="text" id="tb-module-name" placeholder="e.g., alu_16bit" readonly>
                    </div>
                    <div class="form-group">
                        <label>Bitwidth</label>
                        <input type="text" id="tb-bitwidth" placeholder="e.g., 16" readonly>
                    </div>
                </div>
            </div>

            <!-- Batch Mode Options -->
            <div id="tb-batch-options" style="display: none;">
                <div class="detected-info">
                    <div class="detected-info-row">
                        <span class="detected-info-label">Source Directory</span>
                        <span class="detected-info-value">output/bdd/</span>
                    </div>
                    <div class="detected-info-row">
                        <span class="detected-info-label">Output Directory</span>
                        <span class="detected-info-value">output/testbench/</span>
                    </div>
                    <div class="detected-info-row">
                        <span class="detected-info-label">Quality Reports</span>
                        <span class="detected-info-value">output/quality_reports/</span>
                    </div>
                </div>
                <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                    ‚ÑπÔ∏è Batch mode will generate testbenches for all .feature files and create a quality comparison
                    report.
                </p>
            </div>
        </div>

        <div class="error-message" id="tb-error"></div>

        <button class="btn btn-primary" style="background: var(--accent-orange);" id="tb-btn"
                onclick="generateTestbenchByMode()">
            <span id="tb-btn-text">‚öôÔ∏è Generate Testbench</span>
            <div class="spinner" id="tb-spinner" style="display: none;"></div>
        </button>

        <!-- Testbench Result -->
        <div class="card result" id="tb-result" style="margin-top: 16px;">
            <div class="result-header">
                <div class="icon">‚úÖ</div>
                <div class="info">
                    <h3 id="tb-filename">Generating...</h3>
                    <p id="tb-info">Ready to generate</p>
                </div>
                <div class="badge" id="tb-badge">TB</div>
            </div>

            <!-- Quality Summary -->
            <div class="detected-info" id="tb-quality-summary">
                <div class="detected-info-row">
                    <span class="detected-info-label">Quality Score</span>
                    <span>
                        <span class="detected-info-value" id="tb-quality-score">-</span>
                        <span class="confidence-badge high" id="tb-quality-grade">-</span>
                    </span>
                </div>
                <div class="detected-info-row">
                    <span class="detected-info-label">Test Cases</span>
                    <span class="detected-info-value" id="tb-test-count">-</span>
                </div>
                <div class="detected-info-row">
                    <span class="detected-info-label">Operations Covered</span>
                    <span class="detected-info-value" id="tb-ops-covered">-</span>
                </div>
                <div class="detected-info-row">
                    <span class="detected-info-label">Corner Cases</span>
                    <span class="detected-info-value" id="tb-corner-cases">-</span>
                </div>
            </div>

            <div class="preview-label">Testbench Preview</div>
            <div class="preview-box" id="tb-preview"></div>
            <div class="action-buttons">
                <button class="btn btn-secondary btn-sm" id="tb-download" onclick="downloadTestbench()">üì• Download .v</button>
                <button class="btn btn-secondary btn-sm" onclick="resetTestbench()">üîÑ Reset</button>
            </div>
        </div>

        <!-- Batch Result -->
        <div class="card result" id="tb-batch-result" style="margin-top: 16px;">
            <div class="result-header">
                <div class="icon">‚úÖ</div>
                <div class="info">
                    <h3 id="tb-batch-title">Batch Generation Complete</h3>
                    <p id="tb-batch-info">-</p>
                </div>
                <div class="badge" id="tb-batch-badge">BATCH</div>
            </div>

            <!-- Batch Summary -->
            <div class="detected-info" id="tb-batch-summary">
                <div class="detected-info-row">
                    <span class="detected-info-label">Total Testbenches</span>
                    <span class="detected-info-value" id="tb-batch-total">-</span>
                </div>
                <div class="detected-info-row">
                    <span class="detected-info-label">LLM Providers</span>
                    <span class="detected-info-value" id="tb-batch-llms">-</span>
                </div>
            </div>

            <!-- LLM Results -->
            <div class="preview-label">Results by LLM</div>
            <div class="preview-box" id="tb-batch-details" style="min-height: 100px; max-height: 200px;"></div>

            <div class="action-buttons">
                <button class="btn btn-secondary btn-sm" onclick="downloadTestbenchZip()">üì¶ Download All (.zip)
                </button>
                <button class="btn btn-secondary btn-sm" onclick="showComparisonModal()">üìä View Comparison</button>
                <button class="btn btn-secondary btn-sm" onclick="resetBatchTestbench()">üîÑ Reset</button>
            </div>
        </div>
    </div>
</div>


    <!-- Step 4: Simulation (Coming Soon) -->
    <div class="step-section collapsed" id="step-4">
        <div class="step-header" onclick="toggleStep(4)">
            <div class="step-number purple" id="step-4-num">4</div>
            <div class="step-title-area">
                <div class="step-title">üöÄ Run Simulation</div>
                <div class="step-subtitle">Execute tests and view results</div>
            </div>
            <div class="step-status pending" id="step-4-status">Coming Soon</div>
            <div class="step-toggle">‚ñº</div>
        </div>
        <div class="step-content">
            <div class="coming-soon">
                <div class="coming-soon-icon">üöß</div>
                <h3>Coming Soon</h3>
                <p>Simulation will be available in the next update</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p><strong>LLM-based Hardware Verification Pipeline</strong></p>
        <p>University of Bremen ‚Ä¢ Group of Computer Architecture (AGRA)</p>
        <div class="footer-links">
            <a href="#" class="footer-link" onclick="showLegalModal(); return false;">Imprint / Legal Notice</a>
            <span class="footer-separator">‚Ä¢</span>
            <a href="#" class="footer-link" onclick="showDevModal(); return false;">Developer</a>
            <span class="footer-separator">‚Ä¢</span>
            <a href="#" class="footer-link" onclick="backToWelcome(); return false;">‚Üê Back to Home</a>
        </div>
    </div>
</div>

</div>

<script>
        // ============================================================
        // Global State
        // ============================================================
        let currentHwFilename = null;
        let currentBddFilename = null;
        let currentDUT = null;
        let uploadedFileData = null;
        let parsedModules = [];
        let selectedModuleIndex = 0;

        // BDD Templates
        const BDD_TEMPLATES = {
            alu: (bw) => `${bw}-bit ALU with:
- ADD operation (A + B)
- SUB operation (A - B)
- AND operation (A & B)
- OR operation (A | B)
- XOR operation (A ^ B)
- Overflow detection
- Zero flag detection
- Boundary value tests`,
            counter: (bw) => `${bw}-bit Counter with:
- UP mode (increment)
- DOWN mode (decrement)
- UP-DOWN mode (ping-pong)
- Load preset value
- Enable control
- Overflow flag
- Zero flag`,
            regfile: (bw, depth) => `${depth || 32}x${bw}-bit Register File with:
- Dual read ports
- Single write port
- x0 always returns 0
- Concurrent read/write test`,
            cpu: (stages) => `${stages || 5}-stage RISC-V CPU with:
- R-type: ADD, SUB, AND, OR, XOR
- I-type: ADDI, LW
- S-type: SW
- B-type: BEQ, BNE
- Forwarding tests
- Hazard tests`,
            other: (bw) => `${bw}-bit module with:
- Basic functionality tests
- Boundary value tests
- Reset behavior tests`
        };

        // ‚úÖ Êñ∞Â¢û: BDD Examples for different module types
        const BDD_EXAMPLES = {
            alu: [
                { label: 'ADD/SUB basic', text: '8-bit ALU with ADD, SUB operations' },
                { label: 'Overflow tests', text: '32-bit ALU with overflow detection for ADD/SUB' },
                { label: 'Boundary values', text: 'Test boundary values 0x00, 0xFF, 0x7F, 0x80' },
                { label: 'All operations', text: '16-bit ALU with ADD, SUB, AND, OR, XOR, NOT operations' }
            ],
            counter: [
                { label: 'Up counting', text: '8-bit counter UP mode from 0 to MAX' },
                { label: 'Down counting', text: '8-bit counter DOWN mode from MAX to 0' },
                { label: 'Up-Down mode', text: '16-bit counter ping-pong mode' },
                { label: 'Load & Reset', text: 'Counter with load preset value and reset tests' }
            ],
            regfile: [
                { label: 'Read/Write', text: 'Basic read and write to registers' },
                { label: 'Dual port', text: 'Simultaneous read from two ports' },
                { label: 'x0 zero', text: 'Register x0 always returns 0 (RISC-V)' },
                { label: 'All registers', text: 'Write and read all 32 registers' }
            ],
            cpu: [
                { label: 'R-type', text: 'ADD, SUB, AND, OR, XOR instructions' },
                { label: 'Load/Store', text: 'LW, SW memory operations' },
                { label: 'Branch', text: 'BEQ, BNE, BLT conditional branches' },
                { label: 'Hazards', text: 'RAW hazards and forwarding tests' }
            ],
            other: [
                { label: 'Basic test', text: 'Basic functionality verification' },
                { label: 'Boundary', text: 'Test boundary values and edge cases' },
                { label: 'Reset', text: 'Reset behavior and initialization tests' }
            ],
            default: [
                { label: 'Basic test', text: 'Basic functionality verification' },
                { label: 'Boundary', text: 'Test boundary values and edge cases' },
                { label: 'Reset', text: 'Reset behavior and initialization tests' }
            ]
        };

        // ‚úÖ Êñ∞Â¢û: Update BDD Examples based on module type
        function updateBddExamples(moduleType) {
            const examples = BDD_EXAMPLES[moduleType] || BDD_EXAMPLES.default;
            const container = document.getElementById('bdd-examples');

            if (!container) return;

            container.innerHTML = examples.map(ex =>
                `<span class="example-chip" onclick="setBddExample('${ex.text.replace(/'/g, "\\'")}')">${ex.label}</span>`
            ).join('');
        }

        // ============================================================
        // Mode Switching
        // ============================================================
        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.mode-content').forEach(content => content.classList.remove('active'));

            document.getElementById(`mode-${mode}-btn`).classList.add('active');
            document.getElementById(`mode-${mode}`).classList.add('active');
        }

        // ============================================================
        // Step Toggle
        // ============================================================
        function toggleStep(stepNum) {
            const section = document.getElementById(`step-${stepNum}`);
            section.classList.toggle('collapsed');
        }

        // ============================================================
        // File Upload Handling
        // ============================================================
        const uploadArea = document.getElementById('upload-area');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        function processFile(file) {
            hideError('upload');
            hideSuccess('upload');

            // Validate extension
            const validExtensions = ['.v', '.sv', '.vh'];
            const ext = '.' + file.name.split('.').pop().toLowerCase();
            if (!validExtensions.includes(ext)) {
                showError('upload', `Unsupported file type: ${ext}. Please upload .v or .sv files.`);
                return;
            }

            // Validate size
            if (file.size > 1024 * 1024) {
                showError('upload', `File too large: ${(file.size / 1024 / 1024).toFixed(2)}MB. Maximum: 1MB`);
                return;
            }

            // Read and upload file
            const reader = new FileReader();
            reader.onload = async (e) => {
                const content = e.target.result;
                await uploadFile(file, content);
            };
            reader.readAsArrayBuffer(file);
        }

        async function uploadFile(file, content) {
            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/api/upload-dut', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (!data.success) {
                    showError('upload', data.error || 'Upload failed');
                    return;
                }

                // Store parsed data
                uploadedFileData = data;
                parsedModules = data.modules || [];
                selectedModuleIndex = 0;

                // Update UI
                document.getElementById('uploaded-filename').textContent = data.filename;
                document.getElementById('uploaded-filesize').textContent =
                    `${(file.size / 1024).toFixed(1)} KB ‚Ä¢ Uploaded successfully`;

                // Show module selector if multiple modules
                if (parsedModules.length > 1) {
                    const selector = document.getElementById('module-selector');
                    const select = document.getElementById('module-select');
                    select.innerHTML = parsedModules.map((m, i) =>
                        `<option value="${i}">${m.name} (${m.detected_type}, ${m.bitwidth}-bit)</option>`
                    ).join('');
                    selector.style.display = 'block';
                } else {
                    document.getElementById('module-selector').style.display = 'none';
                }

                // Display detected info
                updateDetectedInfo(parsedModules[0]);

                // Show result
                document.getElementById('upload-result').classList.add('visible');
                showSuccess('upload', 'File parsed successfully!');

            } catch (error) {
                showError('upload', 'Network error: ' + error.message);
            }
        }

        function onModuleSelect() {
            selectedModuleIndex = parseInt(document.getElementById('module-select').value);
            updateDetectedInfo(parsedModules[selectedModuleIndex]);
        }

        function updateDetectedInfo(module) {
            document.getElementById('detected-module-name').textContent = module.name;
            document.getElementById('detected-type').textContent = module.detected_type.toUpperCase();
            document.getElementById('detected-bitwidth').textContent = module.bitwidth + '-bit';
            document.getElementById('detected-inputs').textContent =
                module.ports.input_names.slice(0, 6).join(', ') +
                (module.ports.input_names.length > 6 ? '...' : '');
            document.getElementById('detected-outputs').textContent =
                module.ports.output_names.slice(0, 6).join(', ') +
                (module.ports.output_names.length > 6 ? '...' : '');

            // Update confidence badge
            const badge = document.getElementById('confidence-badge');
            badge.textContent = module.type_confidence.charAt(0).toUpperCase() + module.type_confidence.slice(1);
            badge.className = 'confidence-badge ' + module.type_confidence;

            // Update override dropdown
            document.getElementById('override-type').value = module.detected_type;
            document.getElementById('override-bitwidth').value = 'auto';
        }

        function removeUploadedFile() {
            uploadedFileData = null;
            parsedModules = [];
            document.getElementById('upload-result').classList.remove('visible');
            document.getElementById('upload-input').value = '';
            hideSuccess('upload');
        }

        function confirmUpload() {
            if (!uploadedFileData || parsedModules.length === 0) {
                showError('upload', 'No file uploaded');
                return;
            }

            const selectedModule = parsedModules[selectedModuleIndex];
            const overrideType = document.getElementById('override-type').value;
            const overrideBitwidth = document.getElementById('override-bitwidth').value;

            // Create DUT info
            const moduleNames = { 'alu': 'ALU', 'counter': 'Counter', 'regfile': 'Register File', 'cpu': 'CPU', 'other': 'Custom' };

            currentDUT = {
                moduleType: overrideType,
                moduleName: moduleNames[overrideType] || overrideType,
                bitwidth: overrideBitwidth === 'auto' ? selectedModule.bitwidth : parseInt(overrideBitwidth),
                filename: uploadedFileData.filename,
                savedPath: uploadedFileData.saved_path,
                source: 'upload',
                moduleName_verilog: selectedModule.name,
                ports: selectedModule.ports
            };

            currentHwFilename = uploadedFileData.filename;

            // Generate BDD requirements
            const bddTemplate = BDD_TEMPLATES[overrideType] || BDD_TEMPLATES.other;
            const bddRequirements = selectedModule.suggested_bdd || bddTemplate(currentDUT.bitwidth);
            document.getElementById('bdd-input').value = bddRequirements;

            // Update UI
            updateBddTabState();
            updateStepStatus(1, 'completed');
            updatePipelineIndicator(1, 'completed');
            updatePipelineIndicator(2, 'active');

            showSuccess('upload', '‚úÖ DUT configured! Proceed to Step 2 to generate tests.');
        }

        // ============================================================
        // Module Type Change (Generate mode)
        // ============================================================
        function onModuleChange() {
            const moduleType = document.getElementById('hw-module').value;
            document.getElementById('hw-depth-group').style.display = moduleType === 'regfile' ? 'block' : 'none';
            document.getElementById('hw-pipeline-group').style.display = moduleType === 'cpu' ? 'block' : 'none';
            document.getElementById('hw-bitwidth-group').style.display = moduleType === 'cpu' ? 'none' : 'block';
        }

        // ============================================================
        // LLM Change
        // ============================================================
        function onHwLlmChange() {
            const llm = document.getElementById('hw-llm').value;
            document.getElementById('hw-model-group').style.display = llm === 'openai' ? 'block' : 'none';
        }

        function onBddLlmChange() {
            const llm = document.getElementById('bdd-llm').value;
            document.getElementById('bdd-model-group').style.display = llm === 'openai' ? 'block' : 'none';
        }

        // ============================================================
        // Examples
        // ============================================================
        function setHwExample(text) {
            document.getElementById('hw-input').value = text;
            const lower = text.toLowerCase();

            if (lower.includes('cpu') || lower.includes('risc')) {
                document.getElementById('hw-module').value = 'cpu';
            } else if (lower.includes('counter')) {
                document.getElementById('hw-module').value = 'counter';
            } else if (lower.includes('regfile') || lower.includes('register')) {
                document.getElementById('hw-module').value = 'regfile';
            } else if (lower.includes('alu')) {
                document.getElementById('hw-module').value = 'alu';
            }
            onModuleChange();

            const bwMatch = text.match(/(\d+)-?bit/i);
            if (bwMatch && ['8', '16', '32', '64'].includes(bwMatch[1])) {
                document.getElementById('hw-bitwidth').value = bwMatch[1];
            }
        }

        function setBddExample(text) {
            document.getElementById('bdd-input').value = text;
            document.getElementById('synced-indicator').style.display = 'none';
        }

        // ============================================================
        // Hardware Generation
        // ============================================================
        async function generateHardware() {
            const moduleType = document.getElementById('hw-module').value;
            const bitwidth = document.getElementById('hw-bitwidth').value;
            const depth = document.getElementById('hw-depth').value;
            const pipelineStages = document.getElementById('hw-pipeline').value;
            const llm = document.getElementById('hw-llm').value;
            const model = llm === 'openai' ? document.getElementById('hw-model').value : null;
            const naturalInput = document.getElementById('hw-input').value.trim();
            const useStreaming = document.getElementById('hw-stream').checked;

            hideError('hw');
            setLoading('hw', true);
            updateStepStatus(1, 'in-progress');

            const payload = {
                module_type: moduleType,
                llm,
                bitwidth: parseInt(bitwidth),
                depth: parseInt(depth),
                pipeline_stages: parseInt(pipelineStages),
                input: naturalInput,
                model
            };

            if (useStreaming) {
                await generateHwWithStreaming(payload);
            } else {
                await generateHwWithoutStreaming(payload);
            }
        }

        async function generateHwWithStreaming(payload) {
            const resultSection = document.getElementById('hw-result');
            const statusDiv = document.getElementById('hw-status');
            const statusText = document.getElementById('hw-status-text');
            const preview = document.getElementById('hw-preview');

            resultSection.classList.add('visible');
            statusDiv.classList.add('visible');
            preview.innerHTML = '<span class="cursor"></span>';
            document.getElementById('hw-filename').textContent = 'Generating...';
            document.getElementById('hw-info').textContent = `Generating with ${payload.llm.toUpperCase()}...`;
            document.getElementById('hw-badge').textContent = payload.llm.toUpperCase();
            document.getElementById('hw-download').style.display = 'none';

            let fullContent = '';

            try {
                const response = await fetch('/api/generate-hardware-stream', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const text = decoder.decode(value);
                    const lines = text.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.type === 'start') {
                                    statusText.textContent = `Connected to ${data.llm.toUpperCase()}...`;
                                } else if (data.type === 'info') {
                                    statusText.textContent = data.message;
                                } else if (data.type === 'chunk') {
                                    fullContent += data.content;
                                    preview.innerHTML = escapeHtml(fullContent) + '<span class="cursor"></span>';
                                    preview.scrollTop = preview.scrollHeight;
                                } else if (data.type === 'complete') {
                                    currentHwFilename = data.filename;
                                    document.getElementById('hw-filename').textContent = data.filename;
                                    document.getElementById('hw-info').textContent = `Generated with ${payload.llm.toUpperCase()}`;
                                    document.getElementById('hw-download').style.display = 'flex';
                                    saveDUTInfo(payload, data.filename, 'llm');
                                    updateStepStatus(1, 'completed');
                                    updatePipelineIndicator(1, 'completed');
                                    updatePipelineIndicator(2, 'active');
                                } else if (data.type === 'error') {
                                    showError('hw', data.message);
                                    updateStepStatus(1, 'pending');
                                }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) {
                showError('hw', error.message);
                updateStepStatus(1, 'pending');
            } finally {
                setLoading('hw', false);
                statusDiv.classList.remove('visible');
                preview.textContent = fullContent;
            }
        }

        async function generateHwWithoutStreaming(payload) {
            try {
                const response = await fetch('/api/generate-hardware', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                if (!data.success) throw new Error(data.error || 'Generation failed');

                currentHwFilename = data.filename;
                document.getElementById('hw-filename').textContent = data.filename;
                document.getElementById('hw-info').textContent = `Generated with ${data.llm.toUpperCase()}`;
                document.getElementById('hw-badge').textContent = data.llm.toUpperCase();
                document.getElementById('hw-preview').textContent = data.full_content;
                document.getElementById('hw-download').style.display = 'flex';
                document.getElementById('hw-result').classList.add('visible');
                saveDUTInfo(payload, data.filename, 'llm');
                updateStepStatus(1, 'completed');
                updatePipelineIndicator(1, 'completed');
                updatePipelineIndicator(2, 'active');
            } catch (error) {
                showError('hw', error.message);
                updateStepStatus(1, 'pending');
            } finally {
                setLoading('hw', false);
            }
        }

        // ============================================================
        // DUT Info
        // ============================================================
        function saveDUTInfo(payload, filename, source) {
            const moduleNames = { 'alu': 'ALU', 'counter': 'Counter', 'regfile': 'Register File', 'cpu': 'RISC-V CPU' };

            currentDUT = {
                moduleType: payload.module_type,
                moduleName: moduleNames[payload.module_type] || payload.module_type,
                bitwidth: payload.bitwidth,
                depth: payload.depth,
                pipelineStages: payload.pipeline_stages,
                filename: filename,
                source: source
            };

            const bddTemplate = BDD_TEMPLATES[payload.module_type] || BDD_TEMPLATES.other;
            document.getElementById('bdd-input').value = bddTemplate(currentDUT.bitwidth, currentDUT.depth);
            updateBddTabState();
        }

        function updateBddTabState() {
            const dutStatus = document.getElementById('dut-status');
            const noDutWarning = document.getElementById('no-dut-warning');
            const syncedIndicator = document.getElementById('synced-indicator');

            if (currentDUT) {
                dutStatus.classList.add('visible');
                noDutWarning.classList.remove('visible');
                document.getElementById('dut-filename').textContent = currentDUT.filename;
                document.getElementById('dut-type-display').textContent = currentDUT.moduleName;
                document.getElementById('dut-bitwidth-display').textContent =
                    currentDUT.moduleType === 'cpu' ? `${currentDUT.pipelineStages}-stage` : `${currentDUT.bitwidth}-bit`;
                document.getElementById('dut-module-badge').textContent = currentDUT.moduleType.toUpperCase();
                document.getElementById('dut-source-badge').textContent = currentDUT.source === 'upload' ? 'UPLOADED' : 'LLM';
                syncedIndicator.style.display = 'flex';

                // ‚úÖ Êñ∞Â¢û: Êõ¥Êñ∞ Examples
                updateBddExamples(currentDUT.moduleType);
            } else {
                dutStatus.classList.remove('visible');
                noDutWarning.classList.add('visible');
                syncedIndicator.style.display = 'none';

                // ‚úÖ Êñ∞Â¢û: ÊòæÁ§∫ÈªòËÆ§ Examples
                updateBddExamples('default');
            }
        }

        // ============================================================
        // BDD Generation
        // ============================================================
        async function generateBDD() {
            const llm = document.getElementById('bdd-llm').value;
            const model = llm === 'openai' ? document.getElementById('bdd-model').value : null;
            const input = document.getElementById('bdd-input').value.trim();
            const useStreaming = document.getElementById('bdd-stream').checked;

            if (!input) {
                showError('bdd', 'Please enter requirements');
                return;
            }

            hideError('bdd');
            setLoading('bdd', true);
            updateStepStatus(2, 'in-progress');

            const payload = { llm, model, input };

            if (useStreaming) {
                await generateBddWithStreaming(payload);
            } else {
                await generateBddWithoutStreaming(payload);
            }
        }

        async function generateBddWithStreaming(payload) {
            const resultSection = document.getElementById('bdd-result');
            const statusDiv = document.getElementById('bdd-status');
            const statusText = document.getElementById('bdd-status-text');
            const preview = document.getElementById('bdd-preview');

            resultSection.classList.add('visible');
            statusDiv.classList.add('visible');
            preview.innerHTML = '<span class="cursor"></span>';
            document.getElementById('bdd-filename').textContent = 'Generating...';
            document.getElementById('bdd-info').textContent = `Generating with ${payload.llm.toUpperCase()}...`;
            document.getElementById('bdd-badge').textContent = payload.llm.toUpperCase();
            document.getElementById('bdd-download').style.display = 'none';

            let fullContent = '';

            try {
                const response = await fetch('/api/generate-stream', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const text = decoder.decode(value);
                    const lines = text.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.type === 'start') {
                                    statusText.textContent = `Connected to ${data.llm.toUpperCase()}...`;
                                } else if (data.type === 'info') {
                                    statusText.textContent = data.message;
                                } else if (data.type === 'chunk') {
                                    fullContent += data.content;
                                    preview.innerHTML = escapeHtml(fullContent) + '<span class="cursor"></span>';
                                    preview.scrollTop = preview.scrollHeight;
                                } else if (data.type === 'complete') {
                                    currentBddFilename = data.filename;
                                    currentBDD = { filename: data.filename, filepath: data.filepath, llm: payload.llm };
                                    updateTbTabState();
                                    document.getElementById('bdd-filename').textContent = data.filename;
                                    document.getElementById('bdd-info').textContent = `Generated with ${payload.llm.toUpperCase()}`;
                                    document.getElementById('bdd-download').style.display = 'flex';
                                    updateStepStatus(2, 'completed');
                                    updatePipelineIndicator(2, 'completed');
                                    updatePipelineIndicator(3, 'active');
                                } else if (data.type === 'error') {
                                    showError('bdd', data.message);
                                    updateStepStatus(2, 'pending');
                                }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) {
                showError('bdd', error.message);
                updateStepStatus(2, 'pending');
            } finally {
                setLoading('bdd', false);
                statusDiv.classList.remove('visible');
                preview.textContent = fullContent;
            }
        }

        async function generateBddWithoutStreaming(payload) {
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                if (!data.success) throw new Error(data.error || 'Generation failed');

                currentBddFilename = data.filename;
                currentBDD = { filename: data.filename, filepath: data.filepath, llm: payload.llm };
                updateTbTabState();
                document.getElementById('bdd-filename').textContent = data.filename;
                document.getElementById('bdd-info').textContent = `Generated with ${data.llm.toUpperCase()}`;
                document.getElementById('bdd-badge').textContent = data.llm.toUpperCase();
                document.getElementById('bdd-preview').textContent = data.full_content;
                document.getElementById('bdd-download').style.display = 'flex';
                document.getElementById('bdd-result').classList.add('visible');
                updateStepStatus(2, 'completed');
                updatePipelineIndicator(2, 'completed');
                updatePipelineIndicator(3, 'active');
            } catch (error) {
                showError('bdd', error.message);
                updateStepStatus(2, 'pending');
            } finally {
                setLoading('bdd', false);
            }
        }

        // ============================================================
        // Status Updates
        // ============================================================
        function updateStepStatus(stepNum, status) {
            const statusEl = document.getElementById(`step-${stepNum}-status`);
            const numEl = document.getElementById(`step-${stepNum}-num`);

            statusEl.className = 'step-status ' + status;

            if (status === 'pending') statusEl.textContent = 'Pending';
            else if (status === 'in-progress') statusEl.textContent = 'In Progress';
            else if (status === 'completed') {
                statusEl.textContent = 'Completed';
                numEl.classList.add('completed');
            }
        }

        function updatePipelineIndicator(stepNum, status) {
            const indicator = document.getElementById(`indicator-${stepNum}`);
            indicator.className = 'pipeline-step-indicator';
            if (status === 'active') indicator.classList.add('active');
            else if (status === 'completed') indicator.classList.add('completed');
        }

        // ============================================================
        // Actions
        // ============================================================
        function downloadHardware() {
            if (currentHwFilename) window.location.href = `/api/download-hardware/${encodeURIComponent(currentHwFilename)}`;
        }

        function downloadBDD() {
            if (currentBddFilename) window.location.href = `/api/download/${encodeURIComponent(currentBddFilename)}`;
        }

        function resetHardware() {
            document.getElementById('hw-result').classList.remove('visible');
            document.getElementById('hw-input').value = '';
            document.getElementById('hw-preview').textContent = '';
            currentHwFilename = null;
            currentDUT = null;
            uploadedFileData = null;
            parsedModules = [];
            document.getElementById('upload-result').classList.remove('visible');
            document.getElementById('upload-input').value = '';
            hideSuccess('upload');
            updateBddTabState();
            updateStepStatus(1, 'pending');
            document.getElementById('step-1-num').classList.remove('completed');
            updatePipelineIndicator(1, 'active');
            updatePipelineIndicator(2, '');

            // ‚úÖ Êñ∞Â¢û: ÈáçÁΩÆ Examples ‰∏∫ÈªòËÆ§
            updateBddExamples('default');
        }

        function resetBDD() {
            document.getElementById('bdd-result').classList.remove('visible');
            document.getElementById('bdd-preview').textContent = '';
            currentBddFilename = null;
            currentBDD = null;
            updateTbTabState();
            updateStepStatus(2, 'pending');
            document.getElementById('step-2-num').classList.remove('completed');
            if (currentDUT) {
                updatePipelineIndicator(2, 'active');
            }
            updatePipelineIndicator(3, '');
        }
        // ============================================================
        // Testbench Generation
        // ============================================================
        let currentTbFilename = null;
        let currentBDD = null;

        // ============================================================
        // Testbench Mode Switching
        // ============================================================
        let tbMode = 'single';  // 'single' or 'batch'

        function switchTbMode(mode) {
            tbMode = mode;

            // Update buttons
            document.getElementById('tb-mode-single-btn').classList.toggle('active', mode === 'single');
            document.getElementById('tb-mode-batch-btn').classList.toggle('active', mode === 'batch');

            // Update options visibility
            document.getElementById('tb-single-options').style.display = mode === 'single' ? 'block' : 'none';
            document.getElementById('tb-batch-options').style.display = mode === 'batch' ? 'block' : 'none';

            // Update button text
            document.getElementById('tb-btn-text').textContent = mode === 'single'
                ? '‚öôÔ∏è Generate Testbench'
                : 'üìö Generate All Testbenches';

            // Update warnings visibility
            if (mode === 'batch') {
                document.getElementById('no-bdd-warning').classList.remove('visible');
            } else {
                if (!currentBDD) {
                    document.getElementById('no-bdd-warning').classList.add('visible');
                }
            }
        }

        function generateTestbenchByMode() {
            if (tbMode === 'single') {
                generateTestbench();
            } else {
                generateTestbenchBatch();
            }
        }

        async function generateTestbenchBatch() {
            hideError('tb');
            setTbLoading(true);
            updateStepStatus(3, 'in-progress');

            // Hide single result, prepare for batch result
            document.getElementById('tb-result').classList.remove('visible');
            document.getElementById('tb-batch-result').classList.remove('visible');

            const payload = {
                dut_info: currentDUT ? {
                    module_type: currentDUT.moduleType,
                    bitwidth: currentDUT.bitwidth
                } : {}
            };

            try {
                const response = await fetch('/api/generate-testbench-batch', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                if (!data.success) throw new Error(data.error || 'Batch generation failed');

                // Update batch result UI
                document.getElementById('tb-batch-title').textContent = 'Batch Generation Complete';
                document.getElementById('tb-batch-info').textContent = `Generated ${data.total_files} testbench(es) from ${data.llm_count} LLM provider(s)`;
                document.getElementById('tb-batch-total').textContent = data.total_files;
                document.getElementById('tb-batch-llms').textContent = data.llm_count;

                // Build details
                let details = '';
                for (const result of data.results) {
                    details += `üìÇ ${result.llm.toUpperCase()} (${result.count} files)\n`;
                    for (const file of result.files) {
                        details += `   ‚îî‚îÄ ${file}\n`;
                    }
                    details += '\n';
                }
                details += `üìä Quality comparison report generated\n`;
                details += `   ‚îî‚îÄ quality_comparison.txt`;

                document.getElementById('tb-batch-details').textContent = details;
                document.getElementById('tb-batch-result').classList.add('visible');

                updateStepStatus(3, 'completed');
                updatePipelineIndicator(3, 'completed');
                updatePipelineIndicator(4, 'active');

            } catch (error) {
                showError('tb', error.message);
                updateStepStatus(3, 'pending');
            } finally {
                setTbLoading(false);
            }
        }

        function resetBatchTestbench() {
            document.getElementById('tb-batch-result').classList.remove('visible');
            updateStepStatus(3, 'pending');
            document.getElementById('step-3-num').classList.remove('completed');
            updatePipelineIndicator(3, currentBDD ? 'active' : '');
            updatePipelineIndicator(4, '');
        }

       // ============================================================
       // Download & Comparison Functions
       // ============================================================
        function downloadTestbenchZip() {
            window.location.href = '/api/download-testbench-zip';
        }

        function downloadQualityZip() {
            window.location.href = '/api/download-quality-zip';
        }

        function showComparisonModal() {
            const modal = document.getElementById('comparison-modal');
            const loading = document.getElementById('comparison-loading');
            const content = document.getElementById('comparison-content');
            const error = document.getElementById('comparison-error');

            // Show modal with loading state
            modal.classList.add('visible');
            loading.style.display = 'block';
            content.style.display = 'none';
            error.style.display = 'none';

            // Fetch comparison data
            fetch('/api/quality-comparison')
                .then(response => response.json())
                .then(data => {
                    loading.style.display = 'none';

                    if (!data.success) {
                        error.style.display = 'block';
                        error.querySelector('p').textContent = '‚ùå ' + (data.error || 'Failed to load data');
                        return;
                    }

                    // Render table
                    renderComparisonTable(data.results);

                    // Render chart
                    renderComparisonChart(data.results);

                    content.style.display = 'block';
                })
                .catch(err => {
                    loading.style.display = 'none';
                    error.style.display = 'block';
                    error.querySelector('p').textContent = '‚ùå Network error: ' + err.message;
                });
        }

        function closeComparisonModal() {
            document.getElementById('comparison-modal').classList.remove('visible');
        }

        function renderComparisonTable(results) {
            const tbody = document.getElementById('comparison-table-body');

            const getMedal = (rank) => {
                if (rank === 1) return 'ü•á';
                if (rank === 2) return 'ü•à';
                if (rank === 3) return 'ü•â';
                return rank;
            };

            tbody.innerHTML = results.map(r => `
                <tr>
                    <td><span class="rank-medal">${getMedal(r.rank)}</span></td>
                    <td><strong>${r.llm.toUpperCase()}</strong></td>
                    <td>${r.count}</td>
                    <td><strong>${r.avg_score.toFixed(1)}%</strong></td>
                    <td style="color: var(--accent);">${r.best_score.toFixed(1)}%</td>
                    <td style="color: var(--text-secondary);">${r.worst_score.toFixed(1)}%</td>
                </tr>
            `).join('');
        }

        function renderComparisonChart(results) {
            const container = document.getElementById('comparison-chart');

            // Find max score for scaling
            const maxScore = Math.max(...results.map(r => r.avg_score), 100);

            container.innerHTML = results.map(r => {
                const barWidth = (r.avg_score / maxScore) * 100;
                const rankClass = r.rank <= 3 ? `rank-${r.rank}` : 'rank-other';

                return `
                    <div class="chart-bar-row">
                        <div class="chart-bar-label">${r.llm.toUpperCase()}</div>
                        <div class="chart-bar-container">
                            <div class="chart-bar ${rankClass}" style="width: ${barWidth}%;"></div>
                        </div>
                        <div class="chart-bar-value">${r.avg_score.toFixed(1)}%</div>
                    </div>
                `;
            }).join('');
        }

        // Close modal when clicking outside
        document.getElementById('comparison-modal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeComparisonModal();
            }
        });

        function updateTbTabState() {
            const bddStatus = document.getElementById('bdd-source-status');
            const noBddWarning = document.getElementById('no-bdd-warning');

            if (currentBDD) {
                bddStatus.classList.add('visible');
                noBddWarning.classList.remove('visible');
                document.getElementById('tb-bdd-filename').textContent = currentBDD.filename;
                document.getElementById('tb-bdd-llm').textContent = currentBDD.llm.toUpperCase();
                document.getElementById('tb-module-badge').textContent = currentDUT ? currentDUT.moduleType.toUpperCase() : 'BDD';

                // Auto-fill DUT info
                if (currentDUT) {
                    document.getElementById('tb-module-name').value = `${currentDUT.moduleType}_${currentDUT.bitwidth}bit`;
                    document.getElementById('tb-bitwidth').value = currentDUT.bitwidth + '-bit';
                }
            } else {
                bddStatus.classList.remove('visible');
                noBddWarning.classList.add('visible');
            }
        }

        async function generateTestbench() {
            if (!currentBDD) {
                showError('tb', 'Please generate BDD test scenarios first (Step 2)');
                return;
            }

            hideError('tb');
            setTbLoading(true);
            updateStepStatus(3, 'in-progress');

            const payload = {
                bdd_filepath: currentBDD.filepath,
                dut_info: currentDUT ? {
                    module_type: currentDUT.moduleType,
                    module_name: `${currentDUT.moduleType}_${currentDUT.bitwidth}bit`,
                    bitwidth: currentDUT.bitwidth
                } : {}
            };

            try {
                const response = await fetch('/api/generate-testbench', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                if (!data.success) throw new Error(data.error || 'Generation failed');

                currentTbFilename = data.filename;
                document.getElementById('tb-filename').textContent = data.filename;
                document.getElementById('tb-info').textContent = `Generated from ${currentBDD.filename}`;
                document.getElementById('tb-badge').textContent = data.llm.toUpperCase();
                document.getElementById('tb-preview').textContent = data.full_content;

                // Update quality summary
                const qs = data.quality_summary;
                document.getElementById('tb-quality-score').textContent = `${qs.score}/100`;
                document.getElementById('tb-quality-grade').textContent = qs.grade;
                document.getElementById('tb-quality-grade').className = 'confidence-badge ' +
                    (qs.score >= 80 ? 'high' : qs.score >= 60 ? 'medium' : 'low');
                document.getElementById('tb-test-count').textContent = qs.total_tests;
                document.getElementById('tb-ops-covered').textContent = `${qs.operations_covered} (${qs.operations_percentage.toFixed(0)}%)`;
                document.getElementById('tb-corner-cases').textContent = `${qs.corner_cases_covered} (${qs.corner_cases_percentage.toFixed(0)}%)`;

                document.getElementById('tb-download').style.display = 'flex';
                document.getElementById('tb-result').classList.add('visible');
                updateStepStatus(3, 'completed');
                updatePipelineIndicator(3, 'completed');
                updatePipelineIndicator(4, 'active');

            } catch (error) {
                showError('tb', error.message);
                updateStepStatus(3, 'pending');
            } finally {
                setTbLoading(false);
            }
        }

            function setTbLoading(loading) {
            const btn = document.getElementById('tb-btn');
            const btnText = document.getElementById('tb-btn-text');
            const spinner = document.getElementById('tb-spinner');
            btn.disabled = loading;
            spinner.style.display = loading ? 'inline-block' : 'none';

            if (loading) {
                btnText.textContent = 'Generating...';
            } else {
                btnText.textContent = tbMode === 'single'
                    ? '‚öôÔ∏è Generate Testbench'
                    : 'üìö Generate All Testbenches';
            }
        }

        function downloadTestbench() {
            if (currentTbFilename) {
                window.location.href = `/api/download-testbench/${encodeURIComponent(currentTbFilename)}`;
            }
        }

        function resetTestbench() {
            document.getElementById('tb-result').classList.remove('visible');
            document.getElementById('tb-preview').textContent = '';
            currentTbFilename = null;
            updateStepStatus(3, 'pending');
            document.getElementById('step-3-num').classList.remove('completed');
            if (currentBDD) {
                updatePipelineIndicator(3, 'active');
            }
            updatePipelineIndicator(4, '');
        }

        // ============================================================
        // Utilities
        // ============================================================
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function setLoading(type, loading) {
            const btn = document.getElementById(`${type}-btn`);
            const btnText = document.getElementById(`${type}-btn-text`);
            const spinner = document.getElementById(`${type}-spinner`);
            btn.disabled = loading;
            spinner.style.display = loading ? 'inline-block' : 'none';
            btnText.textContent = loading ? 'Generating...' : (type === 'hw' ? 'üîß Generate Hardware' : 'üß™ Generate BDD Tests');
        }

        function showError(type, message) {
            const errorDiv = document.getElementById(`${type}-error`);
            errorDiv.textContent = '‚ùå ' + message;
            errorDiv.classList.add('visible');
        }

        function hideError(type) {
            document.getElementById(`${type}-error`).classList.remove('visible');
        }

        function showSuccess(type, message) {
            const successDiv = document.getElementById(`${type}-success`);
            if (successDiv) {
                successDiv.textContent = message;
                successDiv.classList.add('visible');
            }
        }

        function hideSuccess(type) {
            const successDiv = document.getElementById(`${type}-success`);
            if (successDiv) {
                successDiv.classList.remove('visible');
            }
        }
        // ============================================================
        // Welcome Page & Navigation
        // ============================================================
        function enterApp() {
            document.getElementById('welcome-page').style.display = 'none';
            document.getElementById('main-app').classList.add('visible');
        }

        function backToWelcome() {
            document.getElementById('welcome-page').style.display = 'flex';
            document.getElementById('main-app').classList.remove('visible');
        }

        // ============================================================
        // Legal Notice Modal
        // ============================================================
        function showLegalModal() {
            document.getElementById('legal-modal').classList.add('visible');
        }

        function closeLegalModal() {
            document.getElementById('legal-modal').classList.remove('visible');
        }

        // ============================================================
        // Developer Access Modal
        // ============================================================
        const DEV_PASSWORD = 'agra2025';  // ‰Ω†ÂèØ‰ª•‰øÆÊîπËøô‰∏™ÂØÜÁ†Å

        function showDevModal() {
            document.getElementById('dev-modal').classList.add('visible');
            document.getElementById('dev-password').value = '';
            document.getElementById('dev-error').classList.remove('visible');
            document.getElementById('dev-login').style.display = 'block';
            document.getElementById('dev-links').classList.remove('visible');
        }

        function closeDevModal() {
            document.getElementById('dev-modal').classList.remove('visible');
        }

        function verifyDevPassword() {
            const password = document.getElementById('dev-password').value;

            if (password === DEV_PASSWORD) {
                document.getElementById('dev-login').style.display = 'none';
                document.getElementById('dev-links').classList.add('visible');
            } else {
                document.getElementById('dev-error').classList.add('visible');
                document.getElementById('dev-password').value = '';
                document.getElementById('dev-password').focus();
            }
        }

        function handleDevKeyPress(event) {
            if (event.key === 'Enter') {
                verifyDevPassword();
            }
        }

        // Close modals when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('legal-modal')?.addEventListener('click', function(e) {
                if (e.target === this) closeLegalModal();
            });

            document.getElementById('dev-modal')?.addEventListener('click', function(e) {
                if (e.target === this) closeDevModal();
            });
        });
        // Initialize
        updateBddTabState();
</script>
<!-- Quality Comparison Modal -->
<div class="modal-overlay" id="comparison-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üìä Quality Comparison Report</h2>
            <button class="modal-close" onclick="closeComparisonModal()">‚úï</button>
        </div>
        <div class="modal-body">
            <!-- Loading -->
            <div id="comparison-loading" style="text-align: center; padding: 40px;">
                <div class="spinner" style="margin: 0 auto 16px;"></div>
                <p>Loading comparison data...</p>
            </div>

            <!-- Content -->
            <div id="comparison-content" style="display: none;">
                <!-- Table -->
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>LLM Provider</th>
                            <th>Files</th>
                            <th>Avg Score</th>
                            <th>Best</th>
                            <th>Worst</th>
                        </tr>
                    </thead>
                    <tbody id="comparison-table-body">
                    </tbody>
                </table>

                <!-- Chart -->
                <div class="chart-container">
                    <div class="chart-title">Average Quality Score by LLM</div>
                    <div id="comparison-chart"></div>
                </div>
            </div>

            <!-- Error -->
            <div id="comparison-error" style="display: none; text-align: center; padding: 40px; color: var(--error);">
                <p>‚ùå Failed to load comparison data</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary btn-sm" onclick="downloadQualityZip()">
                üì• Download Full Reports (.zip)
            </button>
            <button class="btn btn-primary btn-sm" onclick="closeComparisonModal()">
                Close
            </button>
        </div>
    </div>
</div>
<!-- Legal Notice Modal -->
<div class="modal-overlay" id="legal-modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>üìú Imprint / Legal Notice</h2>
            <button class="modal-close" onclick="closeLegalModal()">‚úï</button>
        </div>
        <div class="modal-body">
            <div class="legal-content">
                <h3>Institution</h3>
                <p>
                    <strong>University of Bremen</strong><br>
                    Group of Computer Architecture (AGRA)<br>
                    Faculty 3<br>
                    Bibliothekstr. 5<br>
                    28359 Bremen<br>
                    Germany
                </p>

                <h3>Contact</h3>
                <p>
                    üìß Email: <a href="mailto:drechsler@uni-bremen.de">drechsler@uni-bremen.de</a><br>
                    üìß Email: <a href="mailto:treebush302@gmail.com">treebush302@gmail.com</a>
                </p>

                <h3>Responsible for Content</h3>
                <p>
                    Prof. Dr. Rolf Drechsler<br>
                    Qian Liu
                </p>

                <h3>Copyright</h3>
                <p>
                    ¬© 2025 University of Bremen, AGRA Group.<br>
                    All rights reserved.
                </p>

                <h3>Disclaimer</h3>
                <p>
                    This tool is provided for research and educational purposes.
                    The generated code should be reviewed and verified before use in production environments.
                </p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary btn-sm" onclick="closeLegalModal()">Close</button>
        </div>
    </div>
</div>

<!-- Developer Access Modal -->
<div class="modal-overlay" id="dev-modal">
    <div class="modal-content" style="max-width: 450px;">
        <div class="modal-header">
            <h2>üîê Developer Access</h2>
            <button class="modal-close" onclick="closeDevModal()">‚úï</button>
        </div>
        <div class="modal-body">
            <div id="dev-login">
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    Enter the developer password to access the source code repository.
                </p>
                <div class="dev-input-group">
                    <label for="dev-password">Password</label>
                    <input type="password" id="dev-password" placeholder="Enter password" onkeypress="handleDevKeyPress(event)">
                    <div class="dev-error" id="dev-error">‚ùå Incorrect password</div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="verifyDevPassword()">
                    üîì Unlock
                </button>
            </div>
            <div class="dev-links" id="dev-links">
                <p style="color: var(--accent); margin-bottom: 16px;">‚úÖ Access granted!</p>
                <a href="https://github.com/QianLiu301/HdlFormalLLM" target="_blank">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                    View on GitHub
                </a>
            </div>
        </div>
    </div>
</div>
</body>
</html>