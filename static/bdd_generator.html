<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Hardware Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap"
          rel="stylesheet">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #f0f1f3;
            --border-color: #e0e0e0;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --accent: #00a884;
            --accent-hover: #008f70;
            --accent-blue: #2563eb;
            --accent-purple: #7c3aed;
            --error: #dc2626;
            --success: #00a884;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; padding: 32px 24px; }
        .header { text-align: center; margin-bottom: 32px; }
        .header h1 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .header h1 .accent { color: var(--accent); }
        .header h1 .blue { color: var(--accent-blue); }
        .header p { color: var(--text-secondary); font-size: 15px; }
        .tabs { display: flex; gap: 4px; margin-bottom: 24px; background: var(--bg-secondary); padding: 4px; border-radius: 12px; border: 1px solid var(--border-color); }
        .tab { flex: 1; padding: 14px 20px; background: transparent; border: none; border-radius: 8px; color: var(--text-secondary); font-family: inherit; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .tab:hover { color: var(--text-primary); background: var(--bg-tertiary); }
        .tab.active { background: var(--accent); color: #ffffff; }
        .tab.active.alu { background: var(--accent-blue); }
        .tab-icon { font-size: 18px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 28px; margin-bottom: 20px; }
        .card-title { font-size: 16px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .form-group { margin-bottom: 20px; }
        .form-row { display: flex; gap: 16px; margin-bottom: 20px; }
        .form-row .form-group { flex: 1; margin-bottom: 0; }
        label { display: block; font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        select, textarea, input[type="text"] { width: 100%; padding: 12px 16px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-family: inherit; font-size: 15px; transition: border-color 0.2s, box-shadow 0.2s; }
        select:focus, textarea:focus, input[type="text"]:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0, 168, 132, 0.1); }
        select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23666' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 40px; }
        textarea { min-height: 100px; resize: vertical; font-family: 'JetBrains Mono', monospace; font-size: 14px; }
        textarea::placeholder, input::placeholder { color: var(--text-secondary); }
        .divider { display: flex; align-items: center; margin: 16px 0; color: var(--text-secondary); font-size: 13px; }
        .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--border-color); }
        .divider span { padding: 0 12px; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 28px; font-family: inherit; font-size: 15px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--accent); color: #ffffff; width: 100%; }
        .btn-primary.alu { background: var(--accent-blue); }
        .btn-primary:hover:not(:disabled) { transform: translateY(-1px); filter: brightness(1.1); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background: var(--border-color); }
        .btn-download { background: var(--accent); color: #ffffff; }
        .btn-download.alu { background: var(--accent-blue); }
        .spinner { width: 18px; height: 18px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .stream-status { display: none; align-items: center; gap: 12px; padding: 14px 16px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 16px; font-size: 14px; }
        .stream-status.visible { display: flex; }
        .stream-status .dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; animation: pulse 1s ease-in-out infinite; }
        .stream-status .dot.blue { background: var(--accent-blue); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .result { display: none; }
        .result.visible { display: block; animation: fadeIn 0.3s ease; }
        .result-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding-bottom: 14px; border-bottom: 1px solid var(--border-color); }
        .result-header .icon { width: 40px; height: 40px; background: rgba(0, 168, 132, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .result-header .icon.alu { background: rgba(37, 99, 235, 0.1); }
        .result-header .info h3 { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
        .result-header .info p { font-size: 13px; color: var(--text-secondary); }
        .result-header .badge { margin-left: auto; padding: 4px 10px; background: var(--bg-tertiary); border-radius: 4px; font-size: 12px; font-weight: 500; color: var(--accent); text-transform: uppercase; }
        .result-header .badge.alu { color: var(--accent-blue); }
        .preview-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .preview-box { background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 16px; font-family: 'JetBrains Mono', monospace; font-size: 13px; line-height: 1.7; min-height: 200px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; word-break: break-word; color: #333; }
        .preview-box::-webkit-scrollbar { width: 6px; }
        .preview-box::-webkit-scrollbar-track { background: transparent; }
        .preview-box::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        .preview-box .cursor { display: inline-block; width: 2px; height: 1.2em; background: var(--accent); animation: blink 0.8s step-end infinite; vertical-align: text-bottom; }
        .preview-box .cursor.blue { background: var(--accent-blue); }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .action-buttons { display: flex; gap: 12px; margin-top: 20px; }
        .action-buttons .btn { flex: 1; }
        .error-message { background: rgba(220, 38, 38, 0.1); border: 1px solid rgba(220, 38, 38, 0.3); border-radius: 8px; padding: 14px 16px; color: var(--error); font-size: 14px; display: none; margin-bottom: 16px; }
        .error-message.visible { display: block; }
        .examples { margin-top: 10px; }
        .examples-title { font-size: 12px; color: var(--text-secondary); margin-bottom: 8px; }
        .example-chips { display: flex; flex-wrap: wrap; gap: 8px; }
        .example-chip { padding: 6px 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; font-size: 12px; font-family: 'JetBrains Mono', monospace; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; }
        .example-chip:hover { border-color: var(--accent); color: var(--accent); }
        .example-chip.alu:hover { border-color: var(--accent-blue); color: var(--accent-blue); }
        .instructions { background: linear-gradient(135deg, rgba(0, 168, 132, 0.05), rgba(37, 99, 235, 0.05)); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; margin-bottom: 24px; }
        .instructions h2 { font-size: 16px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .instructions-steps { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        @media (max-width: 640px) { .instructions-steps { grid-template-columns: 1fr; } }
        .step { display: flex; gap: 12px; }
        .step-number { width: 28px; height: 28px; background: var(--bg-tertiary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; flex-shrink: 0; }
        .step-number.blue { background: rgba(37, 99, 235, 0.2); color: var(--accent-blue); }
        .step-number.green { background: rgba(0, 168, 132, 0.2); color: var(--accent); }
        .step-content h3 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .step-content p { font-size: 13px; color: var(--text-secondary); line-height: 1.5; }
        .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-top: 1px solid var(--border-color); margin-top: 16px; }
        .toggle-label { font-size: 14px; color: var(--text-secondary); }
        .toggle-switch { position: relative; width: 44px; height: 24px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; inset: 0; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 24px; transition: 0.3s; }
        .toggle-slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background: var(--text-secondary); border-radius: 50%; transition: 0.3s; }
        .toggle-switch input:checked + .toggle-slider { background: var(--accent); border-color: var(--accent); }
        .toggle-switch input:checked + .toggle-slider:before { transform: translateX(20px); background: #ffffff; }
        .footer { text-align: center; padding-top: 24px; color: var(--text-secondary); font-size: 13px; }
        .footer a { color: var(--accent); text-decoration: none; }
        .footer a:hover { text-decoration: underline; }


    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ü§ñ <span class="blue">LLM</span> Hardware <span class="accent">Generator</span></h1>
        <p>Generate ALU Verilog designs and BDD test scenarios using AI</p>
    </div>
    <div class="instructions">
        <h2>üìñ How to Use</h2>
        <div class="instructions-steps">
            <div class="step">
                <div class="step-number blue">1</div>
                <div class="step-content">
                    <h3>Generate ALU Design (DUT)</h3>
                    <p>Use natural language to describe ALU specification. LLM will generate Verilog hardware design for
                        testing.</p>
                </div>
            </div>
            <div class="step">
                <div class="step-number green">2</div>
                <div class="step-content">
                    <h3>Generate BDD Test Scenarios</h3>
                    <p>Use natural language to describe test requirements. LLM will generate BDD Feature files in
                        Gherkin format.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="tabs">
        <button class="tab active alu" data-tab="alu" onclick="switchTab('alu')">
            <span class="tab-icon">üîß</span> ALU Generator
        </button>
        <button class="tab" data-tab="bdd" onclick="switchTab('bdd')">
            <span class="tab-icon">üß™</span> BDD Generator
        </button>
    </div>
    <!-- ALU Generator Tab -->
    <div class="tab-content active" id="tab-alu">
        <div class="card">
            <div class="card-title">‚ö° Quick Select</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="alu-bitwidth">Bitwidth</label>
                    <select id="alu-bitwidth">
                        <option value="8">8-bit</option>
                        <option value="16" selected>16-bit</option>
                        <option value="32">32-bit</option>
                        <option value="64">64-bit</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="alu-llm">LLM Provider</label>
                    <select id="alu-llm">
                        <option value="groq">Groq (Fast & Free)</option>
                        <option value="deepseek">DeepSeek</option>
                        <option value="openai">OpenAI</option>
                        <option value="claude">Claude</option>
                        <option value="gemini">Gemini</option>
                    </select>
                </div>
                <div class="form-group" id="alu-model-group" style="display: none;">
                    <label for="alu-model">Model</label>
                    <select id="alu-model">
                        <option value="gpt-5-mini">GPT-5 Mini</option>
                        <option value="gpt-5">GPT-5</option>
                        <option value="gpt-5.1">GPT-5.1</option>
                    </select>
                </div>
            </div>
            <div class="divider"><span>or use natural language</span></div>
            <div class="form-group">
                <label for="alu-input">Natural Language Input</label>
                <input type="text" id="alu-input" placeholder="e.g., Generate a 32-bit ALU">
                <div class="examples">
                    <div class="examples-title">Examples:</div>
                    <div class="example-chips">
                        <span class="example-chip alu" onclick="setAluExample('8-bit ALU')">8-bit ALU</span>
                        <span class="example-chip alu" onclick="setAluExample('16-bit ALU')">16-bit ALU</span>
                        <span class="example-chip alu" onclick="setAluExample('32-bit ALU')">32-bit ALU</span>
                        <span class="example-chip alu" onclick="setAluExample('64-bit ALU')">64-bit ALU</span>
                    </div>
                </div>
            </div>
            <div class="toggle-row">
                <span class="toggle-label">‚ö° Stream output</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="alu-stream" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="error-message" id="alu-error"></div>
            <div class="stream-status" id="alu-status">
                <div class="dot blue"></div>
                <span id="alu-status-text">Generating...</span>
            </div>
            <button class="btn btn-primary alu" id="alu-btn" onclick="generateALU()">
                <span id="alu-btn-text">üîß Generate ALU</span>
                <div class="spinner" id="alu-spinner" style="display: none;"></div>
            </button>
        </div>
        <div class="card result" id="alu-result">
            <div class="result-header">
                <div class="icon alu">‚úÖ</div>
                <div class="info">
                    <h3 id="alu-filename">alu_16bit.v</h3>
                    <p id="alu-info">Generated with Groq</p>
                </div>
                <div class="badge alu" id="alu-badge">GROQ</div>
            </div>
            <div class="preview-label">Verilog Code Preview</div>
            <div class="preview-box" id="alu-preview"></div>
            <div class="action-buttons">
                <button class="btn btn-download alu" id="alu-download" onclick="downloadALU()">üì• Download .v</button>
                <button class="btn btn-secondary" onclick="resetALU()">üîÑ Generate Another</button>
            </div>
        </div>
    </div>
    <!-- BDD Generator Tab -->
    <div class="tab-content" id="tab-bdd">
        <div class="card">
            <div class="card-title">‚ö° Configuration</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="bdd-llm">LLM Provider</label>
                    <select id="bdd-llm">
                        <option value="groq">Groq (Fast & Free)</option>
                        <option value="deepseek">DeepSeek</option>
                        <option value="openai">OpenAI</option>
                        <option value="claude">Claude</option>
                        <option value="gemini">Gemini</option>
                    </select>
                </div>
                <div class="form-group" id="bdd-model-group" style="display: none;">
                    <label for="bdd-model">Model</label>
                    <select id="bdd-model">
                        <option value="gpt-5-mini">GPT-5 Mini</option>
                        <option value="gpt-5">GPT-5</option>
                        <option value="gpt-5.1">GPT-5.1</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="bdd-input">Requirements</label>
                <textarea id="bdd-input" placeholder="Describe your ALU testing requirements...

Example: 16-bit ALU with ADD, SUB, AND, OR operations"></textarea>
                <div class="examples">
                    <div class="examples-title">Examples:</div>
                    <div class="examples">
                        <div class="examples-title">Examples:</div>
                        <div class="example-chips">
                            <span class="example-chip" onclick="setBddExample('16-bit ALU with ADD, SUB, AND, OR')">16-bit ALU basic</span>
                            <span class="example-chip"
                                  onclick="setBddExample('32-bit ALU: ADD, SUB with overflow tests')">32-bit overflow tests</span>
                            <span class="example-chip"
                                  onclick="setBddExample('8-bit ALU with boundary values 0x00, 0xFF')">8-bit boundary</span>
                            <span class="example-chip"
                                  onclick="setBddExample('16-bit ALU: 10 random test cases for each operation')">16-bit random tests</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="toggle-row">
                <span class="toggle-label">‚ö° Stream output</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="bdd-stream" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="error-message" id="bdd-error"></div>
            <div class="stream-status" id="bdd-status">
                <div class="dot"></div>
                <span id="bdd-status-text">Generating...</span>
            </div>
            <button class="btn btn-primary" id="bdd-btn" onclick="generateBDD()">
                <span id="bdd-btn-text">üß™ Generate BDD</span>
                <div class="spinner" id="bdd-spinner" style="display: none;"></div>
            </button>
        </div>
        <div class="card result" id="bdd-result">
            <div class="result-header">
                <div class="icon">‚úÖ</div>
                <div class="info">
                    <h3 id="bdd-filename">alu_16bit.feature</h3>
                    <p id="bdd-info">Generated with Groq</p>
                </div>
                <div class="badge" id="bdd-badge">GROQ</div>
            </div>
            <div class="preview-label">BDD Feature Preview</div>
            <div class="preview-box" id="bdd-preview"></div>
            <div class="action-buttons">
                <button class="btn btn-download" id="bdd-download" onclick="downloadBDD()">üì• Download .feature</button>
                <button class="btn btn-secondary" onclick="resetBDD()">üîÑ Generate Another</button>
            </div>
        </div>
    </div>
    <div class="footer">
        LLM Hardware Verification Pipeline ‚Ä¢
        <a href="https://github.com/youzi301/HdlFormalLLM" target="_blank">GitHub</a>
    </div>
</div>
<script>
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
                if (t.dataset.tab === 'alu') t.classList.remove('alu');
            });
            const activeTab = document.querySelector(`.tab[data-tab="${tab}"]`);
            activeTab.classList.add('active');
            if (tab === 'alu') activeTab.classList.add('alu');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
        }

        let currentAluFilename = null;
        let currentBddFilename = null;

        // ALU LLM change listener
        document.getElementById('alu-llm').addEventListener('change', function() {
            document.getElementById('alu-model-group').style.display = this.value === 'openai' ? 'block' : 'none';
        });

        // BDD LLM change listener
        document.getElementById('bdd-llm').addEventListener('change', function() {
            document.getElementById('bdd-model-group').style.display = this.value === 'openai' ? 'block' : 'none';
        });

        function setAluExample(text) { document.getElementById('alu-input').value = text; }
        function setBddExample(text) { document.getElementById('bdd-input').value = text; }

        async function generateALU() {
            const bitwidth = document.getElementById('alu-bitwidth').value;
            const llm = document.getElementById('alu-llm').value;
            const model = llm === 'openai' ? document.getElementById('alu-model').value : null;
            const naturalInput = document.getElementById('alu-input').value.trim();
            const useStreaming = document.getElementById('alu-stream').checked;
            hideError('alu');
            setLoading('alu', true);
            const payload = { llm, bitwidth: parseInt(bitwidth), input: naturalInput, model };
            if (useStreaming) { await generateAluWithStreaming(payload); }
            else { await generateAluWithoutStreaming(payload); }
        }

        async function generateAluWithStreaming(payload) {
            const resultSection = document.getElementById('alu-result');
            const statusDiv = document.getElementById('alu-status');
            const statusText = document.getElementById('alu-status-text');
            const preview = document.getElementById('alu-preview');
            resultSection.classList.add('visible');
            statusDiv.classList.add('visible');
            preview.innerHTML = '<span class="cursor blue"></span>';
            document.getElementById('alu-filename').textContent = 'Generating...';
            document.getElementById('alu-download').style.display = 'none';
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            let fullContent = '';
            try {
                const response = await fetch('/api/generate-alu-stream', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    const text = decoder.decode(value);
                    const lines = text.split('\n');
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.type === 'start') {
    statusText.textContent = `Connected to ${data.llm.toUpperCase()}...`;
    if (data.llm) {
        document.getElementById('alu-llm').value = data.llm;
        document.getElementById('alu-model-group').style.display = data.llm === 'openai' ? 'block' : 'none';
        document.getElementById('alu-badge').textContent = data.llm.toUpperCase();
    }
    if (data.bitwidth) {
        document.getElementById('alu-bitwidth').value = data.bitwidth;
    }
}
                                else if (data.type === 'info') { statusText.textContent = data.message; }
                                else if (data.type === 'chunk') {
                                    fullContent += data.content;
                                    preview.innerHTML = escapeHtml(fullContent) + '<span class="cursor blue"></span>';
                                    preview.scrollTop = preview.scrollHeight;
                                }
                                else if (data.type === 'complete') {
                                    currentAluFilename = data.filename;
                                    document.getElementById('alu-filename').textContent = data.filename;
                                    document.getElementById('alu-info').textContent = 'Generated successfully';
                                    document.getElementById('alu-download').style.display = 'flex';
                                }
                                else if (data.type === 'error') { showError('alu', data.message); }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) { showError('alu', error.message); }
            finally { setLoading('alu', false); statusDiv.classList.remove('visible'); preview.textContent = fullContent; }
        }

        async function generateAluWithoutStreaming(payload) {
            try {
                const response = await fetch('/api/generate-alu', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (!data.success) { throw new Error(data.error || 'Generation failed'); }
                currentAluFilename = data.filename;
                document.getElementById('alu-filename').textContent = data.filename;
                document.getElementById('alu-info').textContent = `Generated with ${data.llm}`;
                document.getElementById('alu-badge').textContent = data.llm.toUpperCase();
                document.getElementById('alu-preview').textContent = data.full_content;
                document.getElementById('alu-download').style.display = 'flex';
                document.getElementById('alu-result').classList.add('visible');
            } catch (error) { showError('alu', error.message); }
            finally { setLoading('alu', false); }
        }

        function downloadALU() { if (currentAluFilename) { window.location.href = `/api/download-alu/${encodeURIComponent(currentAluFilename)}`; } }
        function resetALU() {
            document.getElementById('alu-result').classList.remove('visible');
            document.getElementById('alu-input').value = '';
            document.getElementById('alu-preview').textContent = '';
            currentAluFilename = null;
        }

        async function generateBDD() {
            const llm = document.getElementById('bdd-llm').value;
            const model = llm === 'openai' ? document.getElementById('bdd-model').value : null;
            const input = document.getElementById('bdd-input').value.trim();
            const useStreaming = document.getElementById('bdd-stream').checked;
            if (!input) { showError('bdd', 'Please enter your requirements'); return; }
            hideError('bdd');
            setLoading('bdd', true);
            const payload = { llm, model, input };
            if (useStreaming) { await generateBddWithStreaming(payload); }
            else { await generateBddWithoutStreaming(payload); }
        }

        async function generateBddWithStreaming(payload) {
            const resultSection = document.getElementById('bdd-result');
            const statusDiv = document.getElementById('bdd-status');
            const statusText = document.getElementById('bdd-status-text');
            const preview = document.getElementById('bdd-preview');
            resultSection.classList.add('visible');
            statusDiv.classList.add('visible');
            preview.innerHTML = '<span class="cursor"></span>';
            document.getElementById('bdd-filename').textContent = 'Generating...';
            document.getElementById('bdd-download').style.display = 'none';
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            let fullContent = '';
            try {
                const response = await fetch('/api/generate-stream', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    const text = decoder.decode(value);
                    const lines = text.split('\n');
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.type === 'start') {
                                     statusText.textContent = `Connected to ${data.llm.toUpperCase()}...`;
                                     if (data.llm) {
                                          document.getElementById('alu-llm').value = data.llm;
                                          document.getElementById('alu-model-group').style.display = data.llm === 'openai' ? 'block' : 'none';
                                          document.getElementById('alu-badge').textContent = data.llm.toUpperCase();
                                     }
                                if (data.bitwidth) {
                                    document.getElementById('alu-bitwidth').value = data.bitwidth;
                                    }
                                }
                                else if (data.type === 'info') { statusText.textContent = data.message; }
                                else if (data.type === 'chunk') {
                                    fullContent += data.content;
                                    preview.innerHTML = escapeHtml(fullContent) + '<span class="cursor"></span>';
                                    preview.scrollTop = preview.scrollHeight;
                                }
                                else if (data.type === 'complete') {
                                    currentBddFilename = data.filename;
                                    document.getElementById('bdd-filename').textContent = data.filename;
                                    document.getElementById('bdd-info').textContent = 'Generated successfully';
                                    document.getElementById('bdd-download').style.display = 'flex';
                                }
                                else if (data.type === 'error') { showError('bdd', data.message); }
                            } catch (e) {}
                        }
                    }
                }
            } catch (error) { showError('bdd', error.message); }
            finally { setLoading('bdd', false); statusDiv.classList.remove('visible'); preview.textContent = fullContent; }
        }

        async function generateBddWithoutStreaming(payload) {
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (!data.success) { throw new Error(data.error || 'Generation failed'); }
                currentBddFilename = data.filename;
                document.getElementById('bdd-filename').textContent = data.filename;
                document.getElementById('bdd-info').textContent = `Generated with ${data.llm}`;
                document.getElementById('bdd-badge').textContent = data.llm.toUpperCase();
                document.getElementById('bdd-preview').textContent = data.full_content;
                document.getElementById('bdd-download').style.display = 'flex';
                document.getElementById('bdd-result').classList.add('visible');
            } catch (error) { showError('bdd', error.message); }
            finally { setLoading('bdd', false); }
        }

        function downloadBDD() { if (currentBddFilename) { window.location.href = `/api/download/${encodeURIComponent(currentBddFilename)}`; } }
        function resetBDD() {
            document.getElementById('bdd-result').classList.remove('visible');
            document.getElementById('bdd-input').value = '';
            document.getElementById('bdd-preview').textContent = '';
            currentBddFilename = null;
        }

        function escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }
        function setLoading(type, loading) {
            const btn = document.getElementById(`${type}-btn`);
            const btnText = document.getElementById(`${type}-btn-text`);
            const spinner = document.getElementById(`${type}-spinner`);
            btn.disabled = loading;
            spinner.style.display = loading ? 'inline-block' : 'none';
            if (type === 'alu') { btnText.textContent = loading ? 'Generating...' : 'üîß Generate ALU'; }
            else { btnText.textContent = loading ? 'Generating...' : 'üß™ Generate BDD'; }
        }
        function showError(type, message) {
            const errorDiv = document.getElementById(`${type}-error`);
            errorDiv.textContent = '‚ùå ' + message;
            errorDiv.classList.add('visible');
        }
        function hideError(type) { document.getElementById(`${type}-error`).classList.remove('visible'); }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                const activeTab = document.querySelector('.tab-content.active').id;
                if (activeTab === 'tab-alu') { generateALU(); }
                else { generateBDD(); }
            }
        });


</script>
</body>
</html>